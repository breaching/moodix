const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SleepTab-BKELj5Ue.js","assets/vendor-F9Y4d3HK.js","assets/state-Ck21Aizr.js","assets/ActivitiesTab-DzTOj4-v.js","assets/CyclesTab-BgT3GqI-.js","assets/StatsTab-Bwefhe06.js","assets/SettingsTab-CM4r5T25.js"])))=>i.map(i=>d[i]);
import{r as E,a as Ye}from"./vendor-F9Y4d3HK.js";import{c as Z}from"./state-Ck21Aizr.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=r(i);fetch(i.href,n)}})();var ze={exports:{}},K={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xe=E,Qe=Symbol.for("react.element"),Je=Symbol.for("react.fragment"),Ze=Object.prototype.hasOwnProperty,Ke=Xe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,et={key:!0,ref:!0,__self:!0,__source:!0};function Fe(t,e,r){var s,i={},n=null,a=null;r!==void 0&&(n=""+r),e.key!==void 0&&(n=""+e.key),e.ref!==void 0&&(a=e.ref);for(s in e)Ze.call(e,s)&&!et.hasOwnProperty(s)&&(i[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps,e)i[s]===void 0&&(i[s]=e[s]);return{$$typeof:Qe,type:t,key:n,ref:a,props:i,_owner:Ke.current}}K.Fragment=Je;K.jsx=Fe;K.jsxs=Fe;ze.exports=K;var o=ze.exports,Pe,fe=Ye;Pe=fe.createRoot,fe.hydrateRoot;const tt="modulepreload",rt=function(t){return"/"+t},pe={},q=function(e,r,s){let i=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=Promise.allSettled(r.map(c=>{if(c=rt(c),c in pe)return;pe[c]=!0;const d=c.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const g=document.createElement("link");if(g.rel=d?"stylesheet":tt,d||(g.as="script"),g.crossOrigin="",g.href=c,l&&g.setAttribute("nonce",l),document.head.appendChild(g),d)return new Promise((f,x)=>{g.addEventListener("load",f),g.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${c}`)))})}))}function n(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return i.then(a=>{for(const l of a||[])l.status==="rejected"&&n(l.reason);return e().catch(n)})},Y={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},le=new Map,V=t=>{const e=le.get(t);return e?Object.fromEntries(Object.entries(e.stores).map(([r,s])=>[r,s.getState()])):{}},st=(t,e,r)=>{if(t===void 0)return{type:"untracked",connection:e.connect(r)};const s=le.get(r.name);if(s)return{type:"tracked",store:t,...s};const i={connection:e.connect(r),stores:{}};return le.set(r.name,i),{type:"tracked",store:t,...i}},it=(t,e={})=>(r,s,i)=>{const{enabled:n,anonymousActionType:a,store:l,...c}=e;let d;try{d=(n??(Y?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!d)return(Y?"production":void 0)!=="production"&&n&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),t(r,s,i);const{connection:h,...g}=st(l,d,c);let f=!0;i.setState=(u,p,v)=>{const y=r(u,p);if(!f)return y;const b=v===void 0?{type:a||"anonymous"}:typeof v=="string"?{type:v}:v;return l===void 0?(h==null||h.send(b,s()),y):(h==null||h.send({...b,type:`${l}/${b.type}`},{...V(c.name),[l]:i.getState()}),y)};const x=(...u)=>{const p=f;f=!1,r(...u),f=p},m=t(i.setState,s,i);if(g.type==="untracked"?h==null||h.init(m):(g.stores[g.store]=i,h==null||h.init(Object.fromEntries(Object.entries(g.stores).map(([u,p])=>[u,u===g.store?m:p.getState()])))),i.dispatchFromDevtools&&typeof i.dispatch=="function"){let u=!1;const p=i.dispatch;i.dispatch=(...v)=>{(Y?"production":void 0)!=="production"&&v[0].type==="__setState"&&!u&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),u=!0),p(...v)}}return h.subscribe(u=>{var p;switch(u.type){case"ACTION":if(typeof u.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return te(u.payload,v=>{if(v.type==="__setState"){if(l===void 0){x(v.state);return}Object.keys(v.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const y=v.state[l];if(y==null)return;JSON.stringify(i.getState())!==JSON.stringify(y)&&x(y);return}i.dispatchFromDevtools&&typeof i.dispatch=="function"&&i.dispatch(v)});case"DISPATCH":switch(u.payload.type){case"RESET":return x(m),l===void 0?h==null?void 0:h.init(i.getState()):h==null?void 0:h.init(V(c.name));case"COMMIT":if(l===void 0){h==null||h.init(i.getState());return}return h==null?void 0:h.init(V(c.name));case"ROLLBACK":return te(u.state,v=>{if(l===void 0){x(v),h==null||h.init(i.getState());return}x(v[l]),h==null||h.init(V(c.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return te(u.state,v=>{if(l===void 0){x(v);return}JSON.stringify(i.getState())!==JSON.stringify(v[l])&&x(v[l])});case"IMPORT_STATE":{const{nextLiftedState:v}=u.payload,y=(p=v.computedStates.slice(-1)[0])==null?void 0:p.state;if(!y)return;x(l===void 0?y:y[l]),h==null||h.send(null,v);return}case"PAUSE_RECORDING":return f=!f}return}}),m},ee=it,te=(t,e)=>{let r;try{r=JSON.parse(t)}catch(s){console.error("[zustand devtools middleware] Could not parse the received json",s)}r!==void 0&&e(r)};function nt(t,e){let r;try{r=t()}catch{return}return{getItem:i=>{var n;const a=c=>c===null?null:JSON.parse(c,void 0),l=(n=r.getItem(i))!=null?n:null;return l instanceof Promise?l.then(a):a(l)},setItem:(i,n)=>r.setItem(i,JSON.stringify(n,void 0)),removeItem:i=>r.removeItem(i)}}const W=t=>e=>{try{const r=t(e);return r instanceof Promise?r:{then(s){return W(s)(r)},catch(s){return this}}}catch(r){return{then(s){return this},catch(s){return W(s)(r)}}}},at=(t,e)=>(r,s,i)=>{let n={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:p=>p,version:0,merge:(p,v)=>({...v,...p}),...e},a=!1;const l=new Set,c=new Set;let d;try{d=n.getStorage()}catch{}if(!d)return t((...p)=>{console.warn(`[zustand persist middleware] Unable to update item '${n.name}', the given storage is currently unavailable.`),r(...p)},s,i);const h=W(n.serialize),g=()=>{const p=n.partialize({...s()});let v;const y=h({state:p,version:n.version}).then(b=>d.setItem(n.name,b)).catch(b=>{v=b});if(v)throw v;return y},f=i.setState;i.setState=(p,v)=>{f(p,v),g()};const x=t((...p)=>{r(...p),g()},s,i);let m;const u=()=>{var p;if(!d)return;a=!1,l.forEach(y=>y(s()));const v=((p=n.onRehydrateStorage)==null?void 0:p.call(n,s()))||void 0;return W(d.getItem.bind(d))(n.name).then(y=>{if(y)return n.deserialize(y)}).then(y=>{if(y)if(typeof y.version=="number"&&y.version!==n.version){if(n.migrate)return n.migrate(y.state,y.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return y.state}).then(y=>{var b;return m=n.merge(y,(b=s())!=null?b:x),r(m,!0),g()}).then(()=>{v==null||v(m,void 0),a=!0,c.forEach(y=>y(m))}).catch(y=>{v==null||v(void 0,y)})};return i.persist={setOptions:p=>{n={...n,...p},p.getStorage&&(d=p.getStorage())},clearStorage:()=>{d==null||d.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>u(),hasHydrated:()=>a,onHydrate:p=>(l.add(p),()=>{l.delete(p)}),onFinishHydration:p=>(c.add(p),()=>{c.delete(p)})},u(),m||x},ot=(t,e)=>(r,s,i)=>{let n={storage:nt(()=>localStorage),partialize:u=>u,version:0,merge:(u,p)=>({...p,...u}),...e},a=!1;const l=new Set,c=new Set;let d=n.storage;if(!d)return t((...u)=>{console.warn(`[zustand persist middleware] Unable to update item '${n.name}', the given storage is currently unavailable.`),r(...u)},s,i);const h=()=>{const u=n.partialize({...s()});return d.setItem(n.name,{state:u,version:n.version})},g=i.setState;i.setState=(u,p)=>{g(u,p),h()};const f=t((...u)=>{r(...u),h()},s,i);i.getInitialState=()=>f;let x;const m=()=>{var u,p;if(!d)return;a=!1,l.forEach(y=>{var b;return y((b=s())!=null?b:f)});const v=((p=n.onRehydrateStorage)==null?void 0:p.call(n,(u=s())!=null?u:f))||void 0;return W(d.getItem.bind(d))(n.name).then(y=>{if(y)if(typeof y.version=="number"&&y.version!==n.version){if(n.migrate)return[!0,n.migrate(y.state,y.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,y.state];return[!1,void 0]}).then(y=>{var b;const[j,S]=y;if(x=n.merge(S,(b=s())!=null?b:f),r(x,!0),j)return h()}).then(()=>{v==null||v(x,void 0),x=s(),a=!0,c.forEach(y=>y(x))}).catch(y=>{v==null||v(void 0,y)})};return i.persist={setOptions:u=>{n={...n,...u},u.storage&&(d=u.storage)},clearStorage:()=>{d==null||d.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>m(),hasHydrated:()=>a,onHydrate:u=>(l.add(u),()=>{l.delete(u)}),onFinishHydration:u=>(c.add(u),()=>{c.delete(u)})},n.skipHydration||m(),x||f},lt=(t,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?((Y?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),at(t,e)):ot(t,e),ct=lt,Ue=["6h-7h","7h-8h","8h-9h","9h-10h","10h-11h","11h-12h","12h-13h","13h-14h","14h-15h","15h-16h","16h-17h","17h-18h","18h-19h","19h-20h","20h-21h","21h-22h","22h-23h","23h-24h","24h-1h","1h-2h"],dt=["18h","19h","20h","21h","22h","23h","00h","01h","02h","03h","04h","05h","06h","07h","08h","09h","10h","11h","12h","13h","14h","15h","16h","17h"],me={lang:typeof navigator<"u"&&navigator.language.startsWith("fr")?"fr":"en",theme:"dark",colorScheme:"violet",notificationsEnabled:!1,notificationTime:"20:00",consumables:[{key:"exercise",label:"Exercice",icon:"Dumbbell",active:!0,color:"icon-exercise",bg:"icon-bg-exercise",border:""},{key:"caffeine",label:"Caféine",icon:"Coffee",active:!0,color:"icon-caffeine",bg:"icon-bg-caffeine",border:""},{key:"cannabis",label:"Cannabis",icon:"Leaf",active:!0,color:"icon-cannabis",bg:"icon-bg-cannabis",border:""},{key:"medication",label:"Médicament",icon:"Pill",active:!0,color:"icon-medication",bg:"icon-bg-medication",border:""},{key:"custom",label:"Perso",icon:"Beer",active:!1,color:"icon-custom",bg:"icon-bg-custom",border:""}]},is={Coffee:"consumable-icon-coffee",Leaf:"consumable-icon-leaf",Beer:"consumable-icon-wine",Pill:"consumable-icon-pill",Dumbbell:"consumable-icon",Cigarette:"consumable-icon",Skull:"consumable-icon"},ht=t=>t<=3?"text-rose-500":t<=6?"text-amber-400":"text-emerald-400",ut=t=>t<=3?"bg-rose-500":t<=6?"bg-amber-500":"bg-emerald-500",ns=t=>{const e=typeof t=="string"?parseInt(t,10):t;return e?e<=3?"mood-low":e<=6?"mood-medium":"mood-high":"bg-[var(--text-muted)]/30"},ft=(t,e="fr",r)=>{const s=typeof t=="string"?new Date(t):t,i=e==="fr"?"fr-FR":"en-US";return s.toLocaleDateString(i,r)},Be=(t,e="fr")=>ft(t,e,{weekday:"long"}),F=(t,e)=>t?parseInt(t.split(":")[0],10)===(e+18)%24:!1,re=()=>Date.now()+Math.floor(Math.random()*1e3),X=(t,e)=>{try{return JSON.parse(t)}catch{return e}},as=t=>({exercise:"var(--icon-exercise)",caffeine:"var(--icon-caffeine)",cannabis:"var(--icon-cannabis)",medication:"var(--icon-medication)",custom:"var(--icon-custom)"})[t]||"var(--text-main)",os=t=>({exercise:"color-mix(in srgb, var(--icon-exercise) 20%, transparent)",caffeine:"color-mix(in srgb, var(--icon-caffeine) 20%, transparent)",cannabis:"color-mix(in srgb, var(--icon-cannabis) 20%, transparent)",medication:"color-mix(in srgb, var(--icon-medication) 20%, transparent)",custom:"color-mix(in srgb, var(--icon-custom) 20%, transparent)"})[t]||"transparent",H="offline_save_queue",R={getQueue:()=>{try{return X(localStorage.getItem(H)||"[]",[])}catch{return[]}},addToQueue:t=>{const e=R.getQueue();e.push({entry:t,timestamp:Date.now()}),localStorage.setItem(H,JSON.stringify(e))},removeFromQueue:t=>{const e=R.getQueue();e.splice(t,1),localStorage.setItem(H,JSON.stringify(e))},clearQueue:()=>{localStorage.removeItem(H)},processQueue:async()=>{const t=R.getQueue();let e=0;for(let r=t.length-1;r>=0;r--)try{const{entry:s}=t[r];await z._saveToServer(s)&&(R.removeFromQueue(r),e++)}catch(s){console.error("Queue processing error:",s)}return e}};let Q=typeof navigator<"u"?navigator.onLine:!0,se=null,G=0;const ge=3,xe=1e3,z={_isOnline:Q,_lastSaveTime:se,_saveRetryAttempts:G,MAX_RETRIES:ge,RETRY_DELAY:xe,checkAuth:async()=>{try{const t=await fetch("/api/check-auth",{credentials:"include"});return t.ok?await t.json():{authenticated:!1}}catch{return{authenticated:!1}}},login:async(t,e)=>{try{return(await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:t,password:e})})).ok}catch{return!1}},logout:async()=>{try{return await fetch("/api/logout",{method:"POST",credentials:"include"}),!0}catch{return!1}},load:async()=>{try{const t=await fetch("/api/entries",{credentials:"include"});if(t.status===401)return null;if(!t.ok)throw new Error("Server error");const e=await t.json();return localStorage.setItem("journal_data",JSON.stringify(e)),e}catch{return console.warn("Loading from localStorage due to server error"),X(localStorage.getItem("journal_data")||"{}",{})}},_saveToServer:async t=>(await fetch("/api/save",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)})).ok,save:async(t,e=0)=>{try{const r=X(localStorage.getItem("journal_data")||"{}",{});r[t.date]=t,localStorage.setItem("journal_data",JSON.stringify(r))}catch(r){console.error("LocalStorage save failed:",r)}try{if(await z._saveToServer(t))return se=new Date().toLocaleTimeString(),G=0,setTimeout(()=>void R.processQueue(),100),{success:!0,mode:"online"};throw new Error("Server returned error")}catch{return e<ge?(await new Promise(r=>setTimeout(r,xe*Math.pow(2,e))),z.save(t,e+1)):(R.addToQueue(t),G=e,{success:!0,mode:"offline",queued:!0})}},loadSettings:async()=>{try{const e=await fetch("/api/settings",{credentials:"include"});if(e.ok){const r=await e.json();return Object.keys(r).length>0&&localStorage.setItem("journal_settings",JSON.stringify(r)),r}}catch(e){console.error("Settings load error:",e)}const t=localStorage.getItem("journal_settings");return t?X(t,null):null},saveSettings:async t=>{localStorage.setItem("journal_settings",JSON.stringify(t));try{await fetch("/api/settings",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)})}catch(e){console.error("Settings save error:",e)}},getStatus:()=>({online:Q,lastSave:se,queueLength:R.getQueue().length,retryAttempts:G}),admin:{listUsers:async()=>{try{const t=await fetch("/api/admin/users",{credentials:"include"});return t.ok?await t.json():null}catch(t){return console.error("List users error:",t),null}},createUser:async(t,e,r,s)=>{try{const i=await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:t,password:e,email:r,is_admin:s})});return{ok:i.ok,data:i.ok?await i.json():await i.text()}}catch(i){return console.error("Create user error:",i),{ok:!1,data:i.message}}},updateUser:async(t,e)=>{try{const r=await fetch(`/api/admin/users/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});return{ok:r.ok,data:r.ok?await r.json():await r.text()}}catch(r){return console.error("Update user error:",r),{ok:!1,data:r.message}}},deleteUser:async t=>{try{const e=await fetch(`/api/admin/users/${t}`,{method:"DELETE",credentials:"include"});return{ok:e.ok,data:e.ok?await e.json():await e.text()}}catch(e){return console.error("Delete user error:",e),{ok:!1,data:e.message}}},resetPassword:async(t,e)=>{try{const r=await fetch(`/api/admin/users/${t}/reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:e})});return{ok:r.ok,data:r.ok?await r.json():await r.text()}}catch(r){return console.error("Reset password error:",r),{ok:!1,data:r.message}}}}};typeof window<"u"&&(window.addEventListener("online",()=>{Q=!0,R.processQueue()}),window.addEventListener("offline",()=>{Q=!1}));const $e=Z()(ee(t=>({isAuthenticated:!0,isAdmin:!0,currentUserId:1,checkAuth:async()=>(t({isAuthenticated:!0,isAdmin:!0,currentUserId:1}),Promise.resolve()),login:async(e,r)=>(console.log("Login attempt in demo mode:",e,r),Promise.resolve(!0)),logout:async()=>{t({isAuthenticated:!0,isAdmin:!0,currentUserId:1})}}),{name:"auth-store"})),D=Z()(ee(ct((t,e)=>({settings:me,loadSettings:async()=>{const r=await z.loadSettings();if(r&&Object.keys(r).length>0){const s=me.consumables.map((i,n)=>{var l;const a=(l=r.consumables)==null?void 0:l[n];return a?{...i,...a,color:a.color||i.color,bg:a.bg||i.bg}:i});t({settings:{...e().settings,...r,consumables:s}})}},updateSetting:(r,s)=>{const i={...e().settings,[r]:s};t({settings:i}),z.saveSettings(i)},updateSettings:r=>{const s={...e().settings,...r};t({settings:s}),z.saveSettings(s)},updateConsumable:(r,s,i)=>{const n=[...e().settings.consumables],a=n[r];a&&s in a&&(a[s]=i),e().updateSettings({consumables:n})}}),{name:"settings-storage",partialize:t=>({settings:t.settings})}),{name:"settings-store"})),ve=(t,e="fr")=>({date:t,day:Be(t,e),bedtime:[],wakeup:[],sleepHours:Array(24).fill(!1),exercise:[],caffeine:[],cannabis:[],medication:[],custom:[],activityLog:Ue.map(r=>({slot:r,activities:[]})),viciousCycles:[],generalMood:"",dailyNote:"",thoughts:""}),he=Z()(ee((t,e)=>({entries:{},selectedDate:new Date().toISOString().split("T")[0],currentEntry:null,saveStatus:"idle",loadEntries:async()=>{const r=await z.load();if(!r){t({entries:{}});return}const s={},i=D.getState().settings.lang;Object.keys(r).forEach(l=>{const c=r[l];let d=[];c.activityLog&&Array.isArray(c.activityLog)&&c.activityLog.length>0?d=c.activityLog.map(g=>({slot:g.slot||g.time||"0:00",activities:g.activities||[]})):c.timeSlots&&(d=c.timeSlots.map(f=>({slot:f.time||f.slot||"0:00",activities:f.activities||[]})));const h=d.length>0?d:Ue.map(g=>({slot:g,activities:[]}));s[l]={...c,day:Be(l,i),bedtime:Array.isArray(c.bedtime)?c.bedtime:c.bedtime?[c.bedtime]:[],wakeup:Array.isArray(c.wakeup)?c.wakeup:c.wakeup?[c.wakeup]:[],sleepHours:c.sleepHours||Array(24).fill(!1),caffeine:c.caffeine||[],exercise:c.exercise||[],medication:c.medication||[],cannabis:c.cannabis||[],custom:c.custom||[],activityLog:h,viciousCycles:c.viciousCycles||[],generalMood:c.generalMood||"",dailyNote:c.dailyNote||"",thoughts:c.thoughts||""}}),t({entries:s});const n=e().selectedDate,a=s[n]||ve(n,D.getState().settings.lang);t({currentEntry:a}),setTimeout(async()=>{const l=await R.processQueue();l>0&&(P.getState().showToast(`${l} entrée(s) synchronisée(s)`,"success"),await e().loadEntries())},1e3)},clearEntries:()=>{t({entries:{},currentEntry:null})},setSelectedDate:r=>{const{entries:s}=e(),i=D.getState().settings.lang,n=s[r]||ve(r,i);t({selectedDate:r,currentEntry:n})},changeDate:r=>{const{selectedDate:s}=e(),i=new Date(s);i.setDate(i.getDate()+r),e().setSelectedDate(i.toISOString().split("T")[0])},updateEntry:(r,s)=>{const{currentEntry:i}=e();i&&t({currentEntry:{...i,[r]:s}})},saveCurrentEntry:async()=>{const{currentEntry:r,entries:s}=e();if(!r)return;t({saveStatus:"saving"});const i={...r,activityLog:r.activityLog.map(a=>({...a,activities:a.activities.filter(l=>l.name.trim()!=="")}))},n=await z.save(i);n.success?(t({entries:{...s,[i.date]:i},saveStatus:n.mode==="offline"?"offline":"saved"}),(n.mode==="offline"||n.queued)&&P.getState().showToast("Sauvegardé localement (hors ligne)","warning"),setTimeout(()=>t({saveStatus:"idle"}),2e3)):(t({saveStatus:"error"}),P.getState().showToast("Erreur sauvegarde","error"))},addActivity:r=>{const{currentEntry:s}=e();if(!s)return;const i=[...s.activityLog];i[r]={...i[r],activities:[...i[r].activities,{id:re(),name:"",plaisir:5,maitrise:5,satisfaction:5}]},e().updateEntry("activityLog",i)},updateActivity:(r,s,i,n)=>{const{currentEntry:a}=e();if(!a)return;const l=a.activityLog.map((c,d)=>d!==r?c:{...c,activities:c.activities.map(h=>h.id===s?{...h,[i]:n}:h)});e().updateEntry("activityLog",l)},removeActivity:(r,s)=>{const{currentEntry:i}=e();if(!i)return;const n=[...i.activityLog];n[r]={...n[r],activities:n[r].activities.filter(a=>a.id!==s)},e().updateEntry("activityLog",n)},addCycle:()=>{const{currentEntry:r}=e();if(!r)return;const s={id:re(),situation:"",emotions:[],thoughts:[],behaviors:[],consequences:[]};e().updateEntry("viciousCycles",[...r.viciousCycles||[],s])},updateCycle:(r,s,i)=>{const{currentEntry:n}=e();if(!n)return;const a=n.viciousCycles.map(l=>l.id===r?{...l,[s]:i}:l);e().updateEntry("viciousCycles",a)},removeCycle:r=>{const{currentEntry:s}=e();s&&e().updateEntry("viciousCycles",s.viciousCycles.filter(i=>i.id!==r))},addSubItem:(r,s,i)=>{const{currentEntry:n}=e();if(!n)return;const a=n.viciousCycles.find(l=>l.id===r);a&&e().updateCycle(r,s,[...a[s]||[],{...i,id:re()}])},updateSubItem:(r,s,i,n,a)=>{const{currentEntry:l}=e();if(!l)return;const c=l.viciousCycles.find(h=>h.id===r);if(!c)return;const d=c[s].map(h=>h.id===i?{...h,[n]:a}:h);e().updateCycle(r,s,d)},removeSubItem:(r,s,i)=>{const{currentEntry:n}=e();if(!n)return;const a=n.viciousCycles.find(l=>l.id===r);a&&e().updateCycle(r,s,a[s].filter(l=>l.id!==i))},addConsumable:(r,s)=>{const{currentEntry:i}=e();if(!i)return;const n=i[r]||[];e().updateEntry(r,[...n,{time:s}])},removeConsumable:(r,s)=>{const{currentEntry:i}=e();if(!i)return;const n=i[r]||[];e().updateEntry(r,n.filter((a,l)=>l!==s))}}),{name:"journal-store"})),P=Z()(ee((t,e)=>({activeTab:"sleep",toast:null,isPrintModalOpen:!1,printSelectedDates:[],printConfig:{sleep:!0,activities:!0,cycles:!0},plasmaBlurred:!1,setActiveTab:r=>t({activeTab:r}),showToast:(r,s="success")=>{t({toast:{msg:r,type:s}}),setTimeout(()=>t({toast:null}),3e3)},hideToast:()=>t({toast:null}),openPrintModal:()=>t({isPrintModalOpen:!0}),closePrintModal:()=>t({isPrintModalOpen:!1}),togglePrintDate:r=>{const{printSelectedDates:s}=e();s.includes(r)?t({printSelectedDates:s.filter(i=>i!==r)}):t({printSelectedDates:[...s,r]})},setPrintSelectedDates:r=>t({printSelectedDates:r}),togglePrintConfig:r=>{const{printConfig:s}=e();t({printConfig:{...s,[r]:!s[r]}})},setPlasmaBlurred:r=>t({plasmaBlurred:r})}),{name:"ui-store"})),k={Moon:({className:t="w-6 h-6"})=>o.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})}),Sun:({className:t="w-6 h-6"})=>o.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}),Printer:({className:t="w-6 h-6"})=>o.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),ChevronLeft:({className:t="w-5 h-5"})=>o.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})}),ChevronRight:({className:t="w-5 h-5"})=>o.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})}),X:({className:t="w-4 h-4"})=>o.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})}),Chart:({className:t="w-5 h-5"})=>o.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),List:({className:t="w-5 h-5"})=>o.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})}),Brain:({className:t="w-5 h-5"})=>o.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),Dumbbell:({className:t="w-5 h-5"})=>o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[o.jsx("path",{d:"M17.596 12.768a2 2 0 1 0 2.829-2.829l-1.768-1.767a2 2 0 0 0 2.828-2.829l-2.828-2.828a2 2 0 0 0-2.829 2.828l-1.767-1.768a2 2 0 1 0-2.829 2.829z"}),o.jsx("path",{d:"m2.5 21.5 1.4-1.4"}),o.jsx("path",{d:"m20.1 3.9 1.4-1.4"}),o.jsx("path",{d:"M5.343 21.485a2 2 0 1 0 2.829-2.828l1.767 1.768a2 2 0 1 0 2.829-2.829l-6.364-6.364a2 2 0 1 0-2.829 2.829l1.768 1.767a2 2 0 0 0-2.828 2.829z"}),o.jsx("path",{d:"m9.6 14.4 4.8-4.8"})]}),Coffee:({className:t="w-5 h-5"})=>o.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M18 8h1a4 4 0 010 8h-1M2 8h16v9a4 4 0 01-4 4H6a4 4 0 01-4-4V8zM6 1v3M10 1v3M14 1v3"})}),Leaf:({className:t="w-5 h-5"})=>o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[o.jsx("path",{d:"M12 22v-4"}),o.jsx("path",{d:"M7 12c-1.5 0-4.5 1.5-5 3 3.5 1.5 6 1 6 1-1.5 1.5-2 3.5-2 5 2.5 0 4.5-1.5 6-3 1.5 1.5 3.5 3 6 3 0-1.5-.5-3.5-2-5 0 0 2.5.5 6-1-.5-1.5-3.5-3-5-3 1.5-1 4-4 4-6-2.5 0-5.5 1.5-7 3 0-2.5-.5-5-2-7-1.5 2-2 4.5-2 7-1.5-1.5-4.5-3-7-3 0 2 2.5 5 4 6"})]}),Pill:({className:t="w-5 h-5"})=>o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[o.jsx("circle",{cx:"7",cy:"7",r:"5"}),o.jsx("circle",{cx:"17",cy:"17",r:"5"}),o.jsx("path",{d:"M12 17h10"}),o.jsx("path",{d:"m3.46 10.54 7.08-7.08"})]}),Check:({className:t="w-5 h-5"})=>o.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),Refresh:({className:t="w-5 h-5"})=>o.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),Plus:({className:t="w-4 h-4"})=>o.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})}),Trash:({className:t="w-3 h-3"})=>o.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),Cog:({className:t="w-5 h-5"})=>o.jsxs("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),Beer:({className:t="w-5 h-5"})=>o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[o.jsx("path",{d:"M17 11h1a3 3 0 0 1 0 6h-1"}),o.jsx("path",{d:"M9 12v6"}),o.jsx("path",{d:"M13 12v6"}),o.jsx("path",{d:"M14 7.5c-1 0-1.44.5-3 .5s-2-.5-3-.5-1.72.5-2.5.5a2.5 2.5 0 0 1 0-5c.78 0 1.57.5 2.5.5S9.44 2 11 2s2 1.5 3 1.5 1.72-.5 2.5-.5a2.5 2.5 0 0 1 0 5c-.78 0-1.5-1.5-2.5-.5Z"}),o.jsx("path",{d:"M5 8v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V8"})]}),Cigarette:({className:t="w-5 h-5"})=>o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[o.jsx("path",{d:"M18 12H2v4h16"}),o.jsx("path",{d:"M22 12v4"}),o.jsx("path",{d:"M18 12c0-2.5 2-2.5 2-5"}),o.jsx("path",{d:"M22 7c0-2.5-2-2.5-2 0"})]}),Skull:({className:t="w-5 h-5"})=>o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[o.jsx("circle",{cx:"9",cy:"12",r:"1"}),o.jsx("circle",{cx:"15",cy:"12",r:"1"}),o.jsx("path",{d:"M8 20v2h8v-2"}),o.jsx("path",{d:"m12.5 17-.5-1-.5 1h1z"}),o.jsx("path",{d:"M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"})]}),Download:({className:t="w-5 h-5"})=>o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[o.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),o.jsx("polyline",{points:"7 10 12 15 17 10"}),o.jsx("line",{x1:"12",x2:"12",y1:"15",y2:"3"})]}),Upload:({className:t="w-5 h-5"})=>o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[o.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),o.jsx("polyline",{points:"17 8 12 3 7 8"}),o.jsx("line",{x1:"12",x2:"12",y1:"3",y2:"15"})]}),Loading:({className:t="animate-spin w-4 h-4"})=>o.jsxs("svg",{className:t,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","aria-hidden":"true",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),CheckSmall:({className:t="w-4 h-4"})=>o.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),Shield:({className:t="w-4 h-4"})=>o.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),ChevronDown:({className:t="w-5 h-5"})=>o.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})}),Clock:({className:t="w-4 h-4"})=>o.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),Warning:({className:t="w-5 h-5"})=>o.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),Info:({className:t="w-5 h-5"})=>o.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},ls={Dumbbell:k.Dumbbell,Coffee:k.Coffee,Leaf:k.Leaf,Pill:k.Pill,Beer:k.Beer,Cigarette:k.Cigarette,Skull:k.Skull},cs=E.memo(function({children:e,className:r=""}){const s=E.useRef(null),i=E.useRef(null),n=E.useCallback(l=>{if(!s.current||!i.current)return;const c=s.current.getBoundingClientRect(),d=l.clientX-c.left,h=l.clientY-c.top;i.current.style.opacity="1",i.current.style.background=`radial-gradient(400px circle at ${d}px ${h}px, var(--primary), transparent 40%)`,s.current.style.transform="translateY(-4px)",s.current.style.boxShadow="0 20px 40px -15px rgba(0,0,0,0.3), 0 0 40px var(--primary-glow)"},[]),a=E.useCallback(()=>{i.current&&s.current&&(i.current.style.opacity="0",s.current.style.transform="translateY(0)",s.current.style.boxShadow="")},[]);return o.jsxs("div",{ref:s,className:`relative border border-[var(--glass-border)] ${r}`,style:{transition:"transform 0.3s ease, box-shadow 0.3s ease",background:"var(--glass-bg)"},onMouseMove:n,onMouseLeave:a,children:[o.jsx("div",{ref:i,className:"absolute -inset-[1px] rounded-2xl pointer-events-none transition-opacity duration-300 z-0",style:{opacity:0,WebkitMask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",WebkitMaskComposite:"xor",maskComposite:"exclude",padding:"2px"},"aria-hidden":"true"}),o.jsx("div",{className:"relative z-10",children:e})]})}),ds=E.memo(function({value:e,className:r=""}){const[s,i]=E.useState(e),[n,a]=E.useState(!1);return E.useEffect(()=>{if(e!==s){a(!0),i(e);const l=setTimeout(()=>a(!1),500);return()=>clearTimeout(l)}},[e,s]),o.jsx("span",{className:`number-animate ${n?"changed":""} ${r}`,"aria-live":"polite",children:s})}),pt=()=>E.useCallback(e=>{const r=e.currentTarget,s=r.getBoundingClientRect(),i=Math.max(s.width,s.height),n=e.clientX-s.left-i/2,a=e.clientY-s.top-i/2,l=document.createElement("span");l.className="ripple",l.style.width=l.style.height=`${i}px`,l.style.left=`${n}px`,l.style.top=`${a}px`,r.appendChild(l),setTimeout(()=>l.remove(),600)},[]),ye=["sleep","activities","cycles","stats","settings"],mt=t=>{const e=E.useRef(t),r=ye.indexOf(e.current),i=ye.indexOf(t)>=r?"right":"left";return e.current=t,i==="right"?"tab-content":"tab-content-reverse"},B=E.memo(function({label:e,icon:r,active:s,onClick:i}){const n=pt(),a=l=>{n(l),i()};return o.jsxs("button",{onClick:a,className:`nav-btn ripple-container px-3 py-2 rounded-lg flex items-center gap-2 transition-all duration-200 flex-shrink-0 ${s?"active bg-[var(--primary)] text-white shadow-lg shadow-[var(--primary)]/30 scale-105":"text-[var(--text-muted)] hover:text-[var(--text-main)] hover:bg-[var(--bg-elevated)] hover:scale-105"}`,"aria-pressed":s,"aria-label":e,children:[o.jsx(r,{className:`w-5 h-5 transition-transform ${s?"animate-pop-in":""}`}),o.jsx("span",{className:"text-xs font-bold hidden sm:inline",children:e})]})}),hs=E.memo(function({label:e,value:r,onChange:s}){const i=n=>{s(parseInt(n.target.value,10))};return o.jsxs("div",{className:"flex items-center gap-3",role:"group","aria-label":`${e} slider`,children:[o.jsx("span",{className:`text-xs font-bold w-14 ${ht(r)}`,children:e}),o.jsxs("div",{className:"flex-1 h-2 bg-[var(--bg-card)] rounded-full relative",children:[o.jsx("div",{className:`absolute top-0 left-0 h-full rounded-full transition-all duration-200 ${ut(r)}`,style:{width:`${r*10}%`},"aria-hidden":"true"}),o.jsx("input",{type:"range",min:"0",max:"10",value:r||0,onChange:i,className:"absolute inset-0 opacity-0 cursor-pointer w-full","aria-label":`${e}: ${r} sur 10`,"aria-valuemin":0,"aria-valuemax":10,"aria-valuenow":r}),o.jsx("div",{className:"absolute -top-1 w-4 h-4 bg-white rounded-full shadow pointer-events-none transition-all",style:{left:`calc(${r*10}% - 8px)`},"aria-hidden":"true"})]}),o.jsx("span",{className:"text-xs font-bold w-5 text-right text-[var(--text-muted)]","aria-hidden":"true",children:r})]})}),gt=E.memo(function({toast:e}){const r=()=>{switch(e.type){case"error":return"bg-gradient-to-r from-rose-600 to-rose-500 text-white shadow-rose-900/40";case"warning":return"bg-gradient-to-r from-amber-500 to-amber-400 text-white shadow-amber-900/40";default:return"bg-gradient-to-r from-emerald-600 to-emerald-500 text-white shadow-emerald-900/40"}},s=()=>{switch(e.type){case"error":return o.jsx(k.Info,{className:"w-5 h-5"});case"warning":return o.jsx(k.Warning,{className:"w-5 h-5"});default:return o.jsx(k.Check,{className:"w-5 h-5"})}};return o.jsx("div",{className:"fixed top-4 left-0 right-0 z-50 flex justify-center pointer-events-none",role:"alert","aria-live":"polite",children:o.jsxs("div",{className:`toast-enter px-5 py-3 rounded-2xl text-sm font-bold shadow-2xl pointer-events-auto flex items-center gap-2 ${r()}`,children:[s(),e.msg]})})}),xt={fr:{title:"Mon Journal TCC",tab_sleep:"Sommeil",tab_activities:"Activités",tab_cycles:"Cercles",tab_stats:"Analyse",tab_settings:"Paramètres",cycles_title:"CYCLES DE SOMMEIL",bedtime:"Coucher",wakeup:"Lever",consumption_title:"CONSOMMATION",timeline_title:"CHRONOLOGIE 24H",mood_title:"Humeur du jour",daily_note:"Note de la journée",daily_note_placeholder:"Comment s'est passée votre journée ?",add_btn:"+ Ajouter",activity_placeholder:"Nom de l'activité...",pleasure:"Plaisir",mastery:"Maîtrise",satisfaction:"Satisf.",cycles_header:"CERCLES VICIEUX",new_btn:"+ Nouveau",no_cycles:"Aucun cercle enregistré.",situation_label:"SITUATION (DÉCLENCHEUR)",situation_ph:"Où ? Quand ? Avec qui ?",emotions_label:"ÉMOTIONS",emotions_ph:"Nom de l'émotion...",intensity:"Intensité",add_emotion:"Ajouter une émotion...",thoughts_label:"PENSÉES AUTOMATIQUES",add_thought:"Ajouter une pensée...",behaviors_label:"COMPORTEMENTS",add_behavior:"Ajouter un comportement...",consequences_label:"CONSÉQUENCES",add_consequence:"Ajouter une conséquence...",stats_sleep_mood:"SOMMEIL & HUMEUR (7J)",stats_thoughts:"JOURNAL DES PENSÉES",stats_thoughts_ph:"Note libre...",stats_top_act:"TOP ACTIVITÉS (PLAISIR)",no_data:"Pas assez de données",print_config:"Configuration Impression",print_sections:"SECTIONS À INCLURE",print_sleep:"Sommeil",print_act:"Activités",print_cycles:"Cercles",select_all:"Tout sélectionner",print_btn:"Imprimer",print_title_sleep:"AGENDA DU SOMMEIL",print_title_act:"ACTIVITÉS",save_toast:"Sauvegardé",error_server:"Erreur serveur",loading:"Chargement...",placeholder_txt:"...",settings_title:"PARAMÈTRES",lang_title:"Langue",config_consumables:"Configuration Consommables",data_management:"Gestion des Données",export_data:"Exporter (Backup)",import_data:"Importer",clear_data:"Réinitialiser",clear_confirm:"Voulez-vous vraiment TOUT effacer ?",label_txt:"Nom",icon_txt:"Icône",visible_txt:"Visible",legend_c:"C = Café",legend_a:"A = Addiction 1",legend_m:"M = Médicament",legend_e:"E = Exercice",status_saving:"Sauvegarde...",status_saved:"Enregistré",status_error:"Erreur",user_management:"Gestion des Utilisateurs",users_list:"Liste des Utilisateurs",create_user:"Créer un Utilisateur",create_user_btn:"Créer un Nouvel Utilisateur",edit_user:"Modifier l'Utilisateur",delete_user:"Supprimer l'Utilisateur",username:"Nom d'utilisateur",password:"Mot de passe",email:"Email",admin_privileges:"Privilèges Administrateur",active_status:"Actif",inactive_status:"Inactif",user_id:"ID",created_date:"Date de création",no_email:"Pas d'email",loading_users:"Chargement des utilisateurs...",edit_action:"Modifier l'utilisateur",reset_password:"Réinitialiser le mot de passe",delete_action:"Supprimer l'utilisateur",save_btn:"Enregistrer",cancel_btn:"Annuler",username_required:"Le nom d'utilisateur est requis",password_required:"Le mot de passe est requis",password_min_length:"Le mot de passe doit contenir au moins 8 caractères",user_created:"Utilisateur créé avec succès",user_updated:"Utilisateur modifié avec succès",user_deleted:"Utilisateur supprimé avec succès",password_reset:"Mot de passe réinitialisé avec succès",delete_confirm:`Supprimer l'utilisateur "{username}" ? Cela supprimera définitivement toutes ses données.`,password_prompt:'Entrez le nouveau mot de passe pour "{username}" :',password_min_8:"min 8 caractères",admin_badge:"Admin",you_badge:"Vous",required_field:"requis",appearance:"Apparence",theme_mode:"Mode d'affichage",theme_dark:"Sombre",theme_light:"Clair",color_scheme:"Thème de couleur",color_violet:"Violet",color_blue:"Bleu",color_green:"Vert",color_rose:"Rose",color_orange:"Orange",tab_dashboard:"Tableau de bord",welcome:"Bienvenue",dashboard_subtitle:"Votre progression en un coup d'œil",streak:"Série",days_streak:"{count} jours consécutifs",today_progress:"Progression du jour",mood_trend:"Tendance d'humeur",sleep_average:"Sommeil moyen",hours:"heures",top_activity:"Meilleure activité",achievements:"Accomplissements",unknown_activity:"Activité inconnue",notification_title:"Rappels",enable_notifications:"Activer les notifications",notification_time:"Heure du rappel",notification_message:"N'oubliez pas de remplir votre journal !",notifications_enabled:"Notifications activées",notifications_disabled:"Notifications désactivées",notifications_denied:"Permission refusée",notifications_not_supported:"Notifications non supportées",daily_reminder:"Rappel quotidien",time_to_journal:"C'est l'heure de remplir votre journal !",compare_periods:"Comparer les périodes",last_week:"Semaine dernière",last_month:"Mois dernier",trend_up:"En amélioration",trend_down:"En baisse",trend_stable:"Stable"},en:{title:"My CBT Journal",tab_sleep:"Sleep",tab_activities:"Activities",tab_cycles:"Cycles",tab_stats:"Analysis",tab_settings:"Settings",cycles_title:"SLEEP CYCLES",bedtime:"Bedtime",wakeup:"Wake up",consumption_title:"CONSUMPTION",timeline_title:"24H TIMELINE",mood_title:"Daily Mood",daily_note:"Daily note",daily_note_placeholder:"How was your day?",add_btn:"+ Add",activity_placeholder:"Activity name...",pleasure:"Pleasure",mastery:"Mastery",satisfaction:"Satisf.",cycles_header:"VICIOUS CYCLES",new_btn:"+ New",no_cycles:"No cycle recorded.",situation_label:"SITUATION (TRIGGER)",situation_ph:"Where? When? Who?",emotions_label:"EMOTIONS",emotions_ph:"Emotion name...",intensity:"Intensity",add_emotion:"Add an emotion...",thoughts_label:"AUTOMATIC THOUGHTS",add_thought:"Add a thought...",behaviors_label:"BEHAVIORS",add_behavior:"Add a behavior...",consequences_label:"CONSEQUENCES",add_consequence:"Add a consequence...",stats_sleep_mood:"SLEEP & MOOD (7D)",stats_thoughts:"THOUGHTS JOURNAL",stats_thoughts_ph:"Free note...",stats_top_act:"TOP ACTIVITIES (PLEASURE)",no_data:"Not enough data",print_config:"Print Configuration",print_sections:"SECTIONS TO INCLUDE",print_sleep:"Sleep",print_act:"Activities",print_cycles:"Cycles",select_all:"Select All",print_btn:"Print",print_title_sleep:"SLEEP DIARY",print_title_act:"ACTIVITIES",save_toast:"Saved",error_server:"Server Error",loading:"Loading...",placeholder_txt:"...",settings_title:"SETTINGS",lang_title:"Language",config_consumables:"Consumables Config",data_management:"Data Management",export_data:"Export (Backup)",import_data:"Import",clear_data:"Reset Data",clear_confirm:"Do you really want to clear EVERYTHING?",label_txt:"Name",icon_txt:"Icon",visible_txt:"Visible",legend_c:"C = Coffee",legend_a:"A = Addiction 1",legend_m:"M = Meds",legend_e:"E = Exercise",status_saving:"Saving...",status_saved:"Saved",status_error:"Error",user_management:"User Management",users_list:"Users List",create_user:"Create User",create_user_btn:"Create New User",edit_user:"Edit User",delete_user:"Delete User",username:"Username",password:"Password",email:"Email",admin_privileges:"Admin Privileges",active_status:"Active",inactive_status:"Inactive",user_id:"ID",created_date:"Created",no_email:"No email",loading_users:"Loading users...",edit_action:"Edit user",reset_password:"Reset password",delete_action:"Delete user",save_btn:"Save",cancel_btn:"Cancel",username_required:"Username is required",password_required:"Password is required",password_min_length:"Password must be at least 8 characters",user_created:"User created successfully",user_updated:"User updated successfully",user_deleted:"User deleted successfully",password_reset:"Password reset successfully",delete_confirm:'Delete user "{username}"? This will permanently delete all their data.',password_prompt:'Enter new password for "{username}":',password_min_8:"min 8 chars",admin_badge:"Admin",you_badge:"You",required_field:"required",appearance:"Appearance",theme_mode:"Display Mode",theme_dark:"Dark",theme_light:"Light",color_scheme:"Color Theme",color_violet:"Violet",color_blue:"Blue",color_green:"Green",color_rose:"Rose",color_orange:"Orange",tab_dashboard:"Dashboard",welcome:"Welcome",dashboard_subtitle:"Your progress at a glance",streak:"Streak",days_streak:"{count} days streak",today_progress:"Today's Progress",mood_trend:"Mood Trend",sleep_average:"Average Sleep",hours:"hours",top_activity:"Top Activity",achievements:"Achievements",unknown_activity:"Unknown activity",notification_title:"Reminders",enable_notifications:"Enable notifications",notification_time:"Reminder time",notification_message:"Don't forget to fill in your journal!",notifications_enabled:"Notifications enabled",notifications_disabled:"Notifications disabled",notifications_denied:"Permission denied",notifications_not_supported:"Notifications not supported",daily_reminder:"Daily reminder",time_to_journal:"Time to fill in your journal!",compare_periods:"Compare periods",last_week:"Last week",last_month:"Last month",trend_up:"Improving",trend_down:"Declining",trend_stable:"Stable"}},ue=(t,e)=>xt[t][e]||e;function vt(){const{entries:t}=he(),{settings:e}=D(),{isPrintModalOpen:r,closePrintModal:s,printSelectedDates:i,printConfig:n,togglePrintDate:a,setPrintSelectedDates:l,togglePrintConfig:c}=P(),d=f=>ue(e.lang,f),h=()=>{s(),setTimeout(()=>window.print(),300)},g=f=>{f.target===f.currentTarget&&s()};return r?o.jsx("div",{className:"fixed inset-0 z-[60] bg-black/80 backdrop-blur-md flex items-center justify-center p-4 modal-backdrop no-print",onClick:g,children:o.jsxs("div",{className:"glass-modal w-full max-w-md rounded-3xl shadow-2xl overflow-hidden flex flex-col max-h-[80vh] modal-content border border-[var(--glass-border)]",style:{background:"var(--glass-bg)",backdropFilter:"blur(20px)"},children:[o.jsxs("div",{className:"relative p-5 bg-gradient-to-r from-[var(--bg-card)] to-[var(--bg-main)]",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-[var(--primary)]/5 to-transparent pointer-events-none"}),o.jsxs("div",{className:"relative flex justify-between items-center",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-[var(--primary)] to-[var(--primary-dark)] flex items-center justify-center shadow-lg shadow-[var(--primary)]/30",children:o.jsx(k.Printer,{className:"text-white"})}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-bold text-[var(--text-main)]",children:d("print_config")}),o.jsxs("p",{className:"text-xs text-[var(--text-muted)]",children:[i.length," ",e.lang==="fr"?"jour(s) sélectionné(s)":"day(s) selected"]})]})]}),o.jsx("button",{onClick:s,className:"w-8 h-8 rounded-full bg-[var(--bg-elevated)] hover:bg-[var(--bg-card-hover)] text-[var(--text-muted)] hover:text-[var(--text-main)] flex items-center justify-center transition-all hover:rotate-90",children:o.jsx(k.X,{})})]})]}),o.jsxs("div",{className:"p-4 bg-[var(--bg-main)]/30",children:[o.jsxs("h4",{className:"text-xs font-bold text-[var(--text-muted)] uppercase mb-3 tracking-wider flex items-center gap-2",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})}),d("print_sections")]}),o.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[o.jsxs("button",{onClick:()=>c("sleep"),className:`relative py-3 px-2 text-xs font-bold rounded-xl transition-all duration-300 flex flex-col items-center gap-2 ${n.sleep?"bg-[var(--primary)]/20 text-[var(--primary-light)] shadow-lg shadow-[var(--primary)]/20 ring-2 ring-[var(--primary)]/50":"bg-[var(--bg-card)] text-[var(--text-secondary)] hover:bg-[var(--bg-card-hover)]"}`,children:[o.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center transition-all ${n.sleep?"bg-[var(--primary)]/30":"bg-[var(--bg-elevated)]"}`,children:o.jsx(k.Moon,{})}),o.jsx("span",{children:d("print_sleep")}),n.sleep&&o.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 rounded-full bg-[var(--primary)] flex items-center justify-center shadow-lg animate-pop-in",children:o.jsx(k.Check,{className:"w-3 h-3 text-white"})})]}),o.jsxs("button",{onClick:()=>c("activities"),className:`relative py-3 px-2 text-xs font-bold rounded-xl transition-all duration-300 flex flex-col items-center gap-2 ${n.activities?"bg-[var(--accent)]/20 text-[var(--accent-light)] shadow-lg shadow-[var(--accent)]/20 ring-2 ring-[var(--accent)]/50":"bg-[var(--bg-card)] text-[var(--text-secondary)] hover:bg-[var(--bg-card-hover)]"}`,children:[o.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center transition-all ${n.activities?"bg-[var(--accent)]/30":"bg-[var(--bg-elevated)]"}`,children:o.jsx(k.List,{})}),o.jsx("span",{children:d("print_act")}),n.activities&&o.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 rounded-full bg-[var(--accent)] flex items-center justify-center shadow-lg animate-pop-in",children:o.jsx(k.Check,{className:"w-3 h-3 text-white"})})]}),o.jsxs("button",{onClick:()=>c("cycles"),className:`relative py-3 px-2 text-xs font-bold rounded-xl transition-all duration-300 flex flex-col items-center gap-2 ${n.cycles?"bg-[var(--icon-wake)]/20 text-[var(--icon-wake)] shadow-lg shadow-[var(--icon-wake)]/20 ring-2 ring-[var(--icon-wake)]/50":"bg-[var(--bg-card)] text-[var(--text-secondary)] hover:bg-[var(--bg-card-hover)]"}`,children:[o.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center transition-all ${n.cycles?"bg-[var(--icon-wake)]/30":"bg-[var(--bg-elevated)]"}`,children:o.jsx(k.Refresh,{})}),o.jsx("span",{children:d("print_cycles")}),n.cycles&&o.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 rounded-full bg-[var(--icon-wake)] flex items-center justify-center shadow-lg animate-pop-in",children:o.jsx(k.Check,{className:"w-3 h-3 text-white"})})]})]})]}),o.jsxs("div",{className:"min-h-0 flex-1 overflow-hidden flex flex-col",children:[o.jsxs("div",{className:"px-4 py-2 bg-[var(--bg-card)]/50 flex items-center justify-between flex-shrink-0",children:[o.jsxs("h4",{className:"text-xs font-bold text-[var(--text-muted)] uppercase tracking-wider flex items-center gap-2",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.lang==="fr"?"Sélectionner les dates":"Select dates"]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:()=>l(Object.keys(t)),className:"text-xs text-[var(--primary)] font-bold px-3 py-1.5 rounded-lg hover:bg-[var(--primary)]/10 transition-colors",children:d("select_all")}),i.length>0&&o.jsx("button",{onClick:()=>l([]),className:"text-xs text-[var(--text-muted)] font-bold px-3 py-1.5 rounded-lg hover:bg-[var(--bg-elevated)] transition-colors",children:e.lang==="fr"?"Désélectionner":"Clear"})]})]}),o.jsxs("div",{className:"p-3 overflow-y-auto flex-1 space-y-2",children:[Object.keys(t).sort().reverse().map((f,x)=>{var b,j,S;const m=i.includes(f),u=t[f],p=((b=u.sleepHours)==null?void 0:b.filter(Boolean).length)>0,v=(j=u.activityLog)==null?void 0:j.some(w=>{var _;return((_=w.activities)==null?void 0:_.length)>0}),y=((S=u.viciousCycles)==null?void 0:S.length)>0;return o.jsxs("div",{onClick:()=>a(f),className:`group flex items-center gap-3 p-3 rounded-xl cursor-pointer transition-all duration-200 ${m?"bg-[var(--primary)]/10 shadow-md shadow-[var(--primary)]/10 ring-1 ring-[var(--primary)]/30":"bg-[var(--bg-card)] hover:bg-[var(--bg-card-hover)]"}`,style:{animationDelay:`${x*30}ms`},children:[o.jsx("div",{className:`w-6 h-6 rounded-lg flex items-center justify-center flex-shrink-0 transition-all duration-300 ${m?"bg-[var(--primary)] scale-110 shadow-lg shadow-[var(--primary)]/30":"bg-[var(--bg-elevated)] group-hover:bg-[var(--bg-card-hover)]"}`,children:m&&o.jsx("svg",{className:"w-4 h-4 text-white animate-pop-in",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M5 13l4 4L19 7"})})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("div",{className:"font-bold text-[var(--text-main)] truncate",children:new Date(f).toLocaleDateString(e.lang==="fr"?"fr-FR":"en-US",{weekday:"long",day:"numeric",month:"long"})}),o.jsxs("div",{className:"flex gap-1.5 mt-1",children:[p&&o.jsx("span",{className:"inline-flex items-center gap-1 text-[10px] font-medium px-1.5 py-0.5 rounded bg-[var(--primary)]/20 text-[var(--primary-light)]",children:o.jsx(k.Moon,{className:"w-3 h-3"})}),v&&o.jsx("span",{className:"inline-flex items-center gap-1 text-[10px] font-medium px-1.5 py-0.5 rounded bg-[var(--accent)]/20 text-[var(--accent-light)]",children:o.jsx(k.List,{className:"w-3 h-3"})}),y&&o.jsx("span",{className:"inline-flex items-center gap-1 text-[10px] font-medium px-1.5 py-0.5 rounded bg-[var(--icon-wake)]/20 text-[var(--icon-wake)]",children:o.jsx(k.Refresh,{className:"w-3 h-3"})}),!p&&!v&&!y&&o.jsx("span",{className:"text-[10px] text-[var(--text-muted)] italic",children:e.lang==="fr"?"Vide":"Empty"})]})]}),o.jsx("div",{className:`w-2 h-8 rounded-full transition-all duration-300 ${m?"bg-[var(--primary)]":"bg-transparent"}`})]},f)}),Object.keys(t).length===0&&o.jsxs("div",{className:"empty-state text-center py-8 text-[var(--text-muted)]",children:[o.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),o.jsx("p",{className:"text-sm",children:e.lang==="fr"?"Aucune entrée disponible":"No entries available"})]})]})]}),o.jsx("div",{className:"p-3 bg-[var(--bg-card)] flex-shrink-0 shadow-[0_-4px_12px_rgba(0,0,0,0.2)]",children:o.jsxs("button",{onClick:h,disabled:i.length===0,className:`btn-interactive ripple-container w-full py-3 rounded-xl font-bold transition-all flex items-center justify-center gap-2 text-sm ${i.length>0?"bg-gradient-to-r from-[var(--primary)] to-[var(--primary-dark)] text-white shadow-lg shadow-[var(--primary)]/30":"bg-[var(--bg-elevated)] text-[var(--text-muted)] cursor-not-allowed"}`,children:[o.jsx(k.Printer,{}),o.jsx("span",{children:d("print_btn")}),i.length>0&&o.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white/20 text-xs",children:i.length})]})})]})}):null}function $(t){let e=t[0],r=t[1],s=t[2];return Math.sqrt(e*e+r*r+s*s)}function ce(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function yt(t,e,r,s){return t[0]=e,t[1]=r,t[2]=s,t}function be(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function we(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function bt(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function wt(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function ie(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function _t(t,e){let r=e[0]-t[0],s=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(r*r+s*s+i*i)}function jt(t,e){let r=e[0]-t[0],s=e[1]-t[1],i=e[2]-t[2];return r*r+s*s+i*i}function _e(t){let e=t[0],r=t[1],s=t[2];return e*e+r*r+s*s}function St(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Ct(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function de(t,e){let r=e[0],s=e[1],i=e[2],n=r*r+s*s+i*i;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function We(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function je(t,e,r){let s=e[0],i=e[1],n=e[2],a=r[0],l=r[1],c=r[2];return t[0]=i*c-n*l,t[1]=n*a-s*c,t[2]=s*l-i*a,t}function Et(t,e,r,s){let i=e[0],n=e[1],a=e[2];return t[0]=i+s*(r[0]-i),t[1]=n+s*(r[1]-n),t[2]=a+s*(r[2]-a),t}function Mt(t,e,r,s,i){const n=Math.exp(-s*i);let a=e[0],l=e[1],c=e[2];return t[0]=r[0]+(a-r[0])*n,t[1]=r[1]+(l-r[1])*n,t[2]=r[2]+(c-r[2])*n,t}function kt(t,e,r){let s=e[0],i=e[1],n=e[2],a=r[3]*s+r[7]*i+r[11]*n+r[15];return a=a||1,t[0]=(r[0]*s+r[4]*i+r[8]*n+r[12])/a,t[1]=(r[1]*s+r[5]*i+r[9]*n+r[13])/a,t[2]=(r[2]*s+r[6]*i+r[10]*n+r[14])/a,t}function Nt(t,e,r){let s=e[0],i=e[1],n=e[2],a=r[3]*s+r[7]*i+r[11]*n+r[15];return a=a||1,t[0]=(r[0]*s+r[4]*i+r[8]*n)/a,t[1]=(r[1]*s+r[5]*i+r[9]*n)/a,t[2]=(r[2]*s+r[6]*i+r[10]*n)/a,t}function At(t,e,r){let s=e[0],i=e[1],n=e[2];return t[0]=s*r[0]+i*r[3]+n*r[6],t[1]=s*r[1]+i*r[4]+n*r[7],t[2]=s*r[2]+i*r[5]+n*r[8],t}function Lt(t,e,r){let s=e[0],i=e[1],n=e[2],a=r[0],l=r[1],c=r[2],d=r[3],h=l*n-c*i,g=c*s-a*n,f=a*i-l*s,x=l*f-c*g,m=c*h-a*f,u=a*g-l*h,p=d*2;return h*=p,g*=p,f*=p,x*=2,m*=2,u*=2,t[0]=s+h+x,t[1]=i+g+m,t[2]=n+f+u,t}const Tt=function(){const t=[0,0,0],e=[0,0,0];return function(r,s){ce(t,r),ce(e,s),de(t,t),de(e,e);let i=We(t,e);return i>1?0:i<-1?Math.PI:Math.acos(i)}}();function Ot(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}class I extends Array{constructor(e=0,r=e,s=e){return super(e,r,s),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(e){this[0]=e}set y(e){this[1]=e}set z(e){this[2]=e}set(e,r=e,s=e){return e.length?this.copy(e):(yt(this,e,r,s),this)}copy(e){return ce(this,e),this}add(e,r){return r?be(this,e,r):be(this,this,e),this}sub(e,r){return r?we(this,e,r):we(this,this,e),this}multiply(e){return e.length?bt(this,this,e):ie(this,this,e),this}divide(e){return e.length?wt(this,this,e):ie(this,this,1/e),this}inverse(e=this){return Ct(this,e),this}len(){return $(this)}distance(e){return e?_t(this,e):$(this)}squaredLen(){return _e(this)}squaredDistance(e){return e?jt(this,e):_e(this)}negate(e=this){return St(this,e),this}cross(e,r){return r?je(this,e,r):je(this,this,e),this}scale(e){return ie(this,this,e),this}normalize(){return de(this,this),this}dot(e){return We(this,e)}equals(e){return Ot(this,e)}applyMatrix3(e){return At(this,this,e),this}applyMatrix4(e){return kt(this,this,e),this}scaleRotateMatrix4(e){return Nt(this,this,e),this}applyQuaternion(e){return Lt(this,this,e),this}angle(e){return Tt(this,e)}lerp(e,r){return Et(this,this,e,r),this}smoothLerp(e,r,s){return Mt(this,this,e,r,s),this}clone(){return new I(this[0],this[1],this[2])}fromArray(e,r=0){return this[0]=e[r],this[1]=e[r+1],this[2]=e[r+2],this}toArray(e=[],r=0){return e[r]=this[0],e[r+1]=this[1],e[r+2]=this[2],e}transformDirection(e){const r=this[0],s=this[1],i=this[2];return this[0]=e[0]*r+e[4]*s+e[8]*i,this[1]=e[1]*r+e[5]*s+e[9]*i,this[2]=e[2]*r+e[6]*s+e[10]*i,this.normalize()}}const Se=new I;let It=1,Rt=1,Ce=!1;class Dt{constructor(e,r={}){e.canvas||console.error("gl not passed as first argument to Geometry"),this.gl=e,this.attributes=r,this.id=It++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state;for(let s in r)this.addAttribute(s,r[s])}addAttribute(e,r){if(this.attributes[e]=r,r.id=Rt++,r.size=r.size||1,r.type=r.type||(r.data.constructor===Float32Array?this.gl.FLOAT:r.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),r.target=e==="index"?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,r.normalized=r.normalized||!1,r.stride=r.stride||0,r.offset=r.offset||0,r.count=r.count||(r.stride?r.data.byteLength/r.stride:r.data.length/r.size),r.divisor=r.instanced||0,r.needsUpdate=!1,r.usage=r.usage||this.gl.STATIC_DRAW,r.buffer||this.updateAttribute(r),r.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==r.count*r.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,r.count*r.divisor);this.instancedCount=r.count*r.divisor}else e==="index"?this.drawRange.count=r.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,r.count))}updateAttribute(e){const r=!e.buffer;r&&(e.buffer=this.gl.createBuffer()),this.glState.boundBuffer!==e.buffer&&(this.gl.bindBuffer(e.target,e.buffer),this.glState.boundBuffer=e.buffer),r?this.gl.bufferData(e.target,e.data,e.usage):this.gl.bufferSubData(e.target,0,e.data),e.needsUpdate=!1}setIndex(e){this.addAttribute("index",e)}setDrawRange(e,r){this.drawRange.start=e,this.drawRange.count=r}setInstancedCount(e){this.instancedCount=e}createVAO(e){this.VAOs[e.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[e.attributeOrder]),this.bindAttributes(e)}bindAttributes(e){e.attributeLocations.forEach((r,{name:s,type:i})=>{if(!this.attributes[s]){console.warn(`active attribute ${s} not being supplied`);return}const n=this.attributes[s];this.gl.bindBuffer(n.target,n.buffer),this.glState.boundBuffer=n.buffer;let a=1;i===35674&&(a=2),i===35675&&(a=3),i===35676&&(a=4);const l=n.size/a,c=a===1?0:a*a*4,d=a===1?0:a*4;for(let h=0;h<a;h++)this.gl.vertexAttribPointer(r+h,l,n.type,n.normalized,n.stride+c,n.offset+h*d),this.gl.enableVertexAttribArray(r+h),this.gl.renderer.vertexAttribDivisor(r+h,n.divisor)}),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:e,mode:r=this.gl.TRIANGLES}){var i;this.gl.renderer.currentGeometry!==`${this.id}_${e.attributeOrder}`&&(this.VAOs[e.attributeOrder]||this.createVAO(e),this.gl.renderer.bindVertexArray(this.VAOs[e.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${e.attributeOrder}`),e.attributeLocations.forEach((n,{name:a})=>{const l=this.attributes[a];l.needsUpdate&&this.updateAttribute(l)});let s=2;((i=this.attributes.index)==null?void 0:i.type)===this.gl.UNSIGNED_INT&&(s=4),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(r,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*s,this.instancedCount):this.gl.renderer.drawArraysInstanced(r,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(r,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*s):this.gl.drawArrays(r,this.drawRange.start,this.drawRange.count)}getPosition(){const e=this.attributes.position;if(e.data)return e;if(!Ce)return console.warn("No position buffer data found to compute bounds"),Ce=!0}computeBoundingBox(e){e||(e=this.getPosition());const r=e.data,s=e.size;this.bounds||(this.bounds={min:new I,max:new I,center:new I,scale:new I,radius:1/0});const i=this.bounds.min,n=this.bounds.max,a=this.bounds.center,l=this.bounds.scale;i.set(1/0),n.set(-1/0);for(let c=0,d=r.length;c<d;c+=s){const h=r[c],g=r[c+1],f=r[c+2];i.x=Math.min(h,i.x),i.y=Math.min(g,i.y),i.z=Math.min(f,i.z),n.x=Math.max(h,n.x),n.y=Math.max(g,n.y),n.z=Math.max(f,n.z)}l.sub(n,i),a.add(i,n).divide(2)}computeBoundingSphere(e){e||(e=this.getPosition());const r=e.data,s=e.size;this.bounds||this.computeBoundingBox(e);let i=0;for(let n=0,a=r.length;n<a;n+=s)Se.fromArray(r,n),i=Math.max(i,this.bounds.center.squaredDistance(Se));this.bounds.radius=Math.sqrt(i)}remove(){for(let e in this.VAOs)this.gl.renderer.deleteVertexArray(this.VAOs[e]),delete this.VAOs[e];for(let e in this.attributes)this.gl.deleteBuffer(this.attributes[e].buffer),delete this.attributes[e]}}let zt=1;const Ee={};class Ft{constructor(e,{vertex:r,fragment:s,uniforms:i={},transparent:n=!1,cullFace:a=e.BACK,frontFace:l=e.CCW,depthTest:c=!0,depthWrite:d=!0,depthFunc:h=e.LEQUAL}={}){e.canvas||console.error("gl not passed as first argument to Program"),this.gl=e,this.uniforms=i,this.id=zt++,r||console.warn("vertex shader not supplied"),s||console.warn("fragment shader not supplied"),this.transparent=n,this.cullFace=a,this.frontFace=l,this.depthTest=c,this.depthWrite=d,this.depthFunc=h,this.blendFunc={},this.blendEquation={},this.stencilFunc={},this.stencilOp={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)),this.vertexShader=e.createShader(e.VERTEX_SHADER),this.fragmentShader=e.createShader(e.FRAGMENT_SHADER),this.program=e.createProgram(),e.attachShader(this.program,this.vertexShader),e.attachShader(this.program,this.fragmentShader),this.setShaders({vertex:r,fragment:s})}setShaders({vertex:e,fragment:r}){if(e&&(this.gl.shaderSource(this.vertexShader,e),this.gl.compileShader(this.vertexShader),this.gl.getShaderInfoLog(this.vertexShader)!==""&&console.warn(`${this.gl.getShaderInfoLog(this.vertexShader)}
Vertex Shader
${Me(e)}`)),r&&(this.gl.shaderSource(this.fragmentShader,r),this.gl.compileShader(this.fragmentShader),this.gl.getShaderInfoLog(this.fragmentShader)!==""&&console.warn(`${this.gl.getShaderInfoLog(this.fragmentShader)}
Fragment Shader
${Me(r)}`)),this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))return console.warn(this.gl.getProgramInfoLog(this.program));this.uniformLocations=new Map;let s=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_UNIFORMS);for(let a=0;a<s;a++){let l=this.gl.getActiveUniform(this.program,a);this.uniformLocations.set(l,this.gl.getUniformLocation(this.program,l.name));const c=l.name.match(/(\w+)/g);l.uniformName=c[0],l.nameComponents=c.slice(1)}this.attributeLocations=new Map;const i=[],n=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_ATTRIBUTES);for(let a=0;a<n;a++){const l=this.gl.getActiveAttrib(this.program,a),c=this.gl.getAttribLocation(this.program,l.name);c!==-1&&(i[c]=l.name,this.attributeLocations.set(l,c))}this.attributeOrder=i.join("")}setBlendFunc(e,r,s,i){this.blendFunc.src=e,this.blendFunc.dst=r,this.blendFunc.srcAlpha=s,this.blendFunc.dstAlpha=i,e&&(this.transparent=!0)}setBlendEquation(e,r){this.blendEquation.modeRGB=e,this.blendEquation.modeAlpha=r}setStencilFunc(e,r,s){this.stencilRef=r,this.stencilFunc.func=e,this.stencilFunc.ref=r,this.stencilFunc.mask=s}setStencilOp(e,r,s){this.stencilOp.stencilFail=e,this.stencilOp.depthFail=r,this.stencilOp.depthPass=s}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha),this.stencilFunc.func||this.stencilOp.stencilFail?this.gl.renderer.enable(this.gl.STENCIL_TEST):this.gl.renderer.disable(this.gl.STENCIL_TEST),this.gl.renderer.setStencilFunc(this.stencilFunc.func,this.stencilFunc.ref,this.stencilFunc.mask),this.gl.renderer.setStencilOp(this.stencilOp.stencilFail,this.stencilOp.depthFail,this.stencilOp.depthPass)}use({flipFaces:e=!1}={}){let r=-1;this.gl.renderer.state.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.state.currentProgram=this.id),this.uniformLocations.forEach((i,n)=>{let a=this.uniforms[n.uniformName];for(const l of n.nameComponents){if(!a)break;if(l in a)a=a[l];else{if(Array.isArray(a.value))break;a=void 0;break}}if(!a)return ke(`Active uniform ${n.name} has not been supplied`);if(a&&a.value===void 0)return ke(`${n.name} uniform is missing a value parameter`);if(a.value.texture)return r=r+1,a.value.update(r),ne(this.gl,n.type,i,r);if(a.value.length&&a.value[0].texture){const l=[];return a.value.forEach(c=>{r=r+1,c.update(r),l.push(r)}),ne(this.gl,n.type,i,l)}ne(this.gl,n.type,i,a.value)}),this.applyState(),e&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function ne(t,e,r,s){s=s.length?Pt(s):s;const i=t.renderer.state.uniformLocations.get(r);if(s.length)if(i===void 0||i.length!==s.length)t.renderer.state.uniformLocations.set(r,s.slice(0));else{if(Ut(i,s))return;i.set?i.set(s):Bt(i,s),t.renderer.state.uniformLocations.set(r,i)}else{if(i===s)return;t.renderer.state.uniformLocations.set(r,s)}switch(e){case 5126:return s.length?t.uniform1fv(r,s):t.uniform1f(r,s);case 35664:return t.uniform2fv(r,s);case 35665:return t.uniform3fv(r,s);case 35666:return t.uniform4fv(r,s);case 35670:case 5124:case 35678:case 36306:case 35680:case 36289:return s.length?t.uniform1iv(r,s):t.uniform1i(r,s);case 35671:case 35667:return t.uniform2iv(r,s);case 35672:case 35668:return t.uniform3iv(r,s);case 35673:case 35669:return t.uniform4iv(r,s);case 35674:return t.uniformMatrix2fv(r,!1,s);case 35675:return t.uniformMatrix3fv(r,!1,s);case 35676:return t.uniformMatrix4fv(r,!1,s)}}function Me(t){let e=t.split(`
`);for(let r=0;r<e.length;r++)e[r]=r+1+": "+e[r];return e.join(`
`)}function Pt(t){const e=t.length,r=t[0].length;if(r===void 0)return t;const s=e*r;let i=Ee[s];i||(Ee[s]=i=new Float32Array(s));for(let n=0;n<e;n++)i.set(t[n],n*r);return i}function Ut(t,e){if(t.length!==e.length)return!1;for(let r=0,s=t.length;r<s;r++)if(t[r]!==e[r])return!1;return!0}function Bt(t,e){for(let r=0,s=t.length;r<s;r++)t[r]=e[r]}let ae=0;function ke(t){ae>100||(console.warn(t),ae++,ae>100&&console.warn("More than 100 program warnings - stopping logs."))}const oe=new I;let $t=1;class Wt{constructor({canvas:e=document.createElement("canvas"),width:r=300,height:s=150,dpr:i=1,alpha:n=!1,depth:a=!0,stencil:l=!1,antialias:c=!1,premultipliedAlpha:d=!1,preserveDrawingBuffer:h=!1,powerPreference:g="default",autoClear:f=!0,webgl:x=2}={}){const m={alpha:n,depth:a,stencil:l,antialias:c,premultipliedAlpha:d,preserveDrawingBuffer:h,powerPreference:g};this.dpr=i,this.alpha=n,this.color=!0,this.depth=a,this.stencil=l,this.premultipliedAlpha=d,this.autoClear=f,this.id=$t++,x===2&&(this.gl=e.getContext("webgl2",m)),this.isWebgl2=!!this.gl,this.gl||(this.gl=e.getContext("webgl",m)),this.gl||console.error("unable to create webgl context"),this.gl.renderer=this,this.setSize(r,s),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=!1,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LEQUAL,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={x:0,y:0,width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.state.currentProgram=null,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.getExtension("WEBGL_compressed_texture_astc"),this.getExtension("EXT_texture_compression_bptc"),this.getExtension("WEBGL_compressed_texture_s3tc"),this.getExtension("WEBGL_compressed_texture_etc1"),this.getExtension("WEBGL_compressed_texture_pvrtc"),this.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}setSize(e,r){this.width=e,this.height=r,this.gl.canvas.width=e*this.dpr,this.gl.canvas.height=r*this.dpr,this.gl.canvas.style&&Object.assign(this.gl.canvas.style,{width:e+"px",height:r+"px"})}setViewport(e,r,s=0,i=0){this.state.viewport.width===e&&this.state.viewport.height===r||(this.state.viewport.width=e,this.state.viewport.height=r,this.state.viewport.x=s,this.state.viewport.y=i,this.gl.viewport(s,i,e,r))}setScissor(e,r,s=0,i=0){this.gl.scissor(s,i,e,r)}enable(e){this.state[e]!==!0&&(this.gl.enable(e),this.state[e]=!0)}disable(e){this.state[e]!==!1&&(this.gl.disable(e),this.state[e]=!1)}setBlendFunc(e,r,s,i){this.state.blendFunc.src===e&&this.state.blendFunc.dst===r&&this.state.blendFunc.srcAlpha===s&&this.state.blendFunc.dstAlpha===i||(this.state.blendFunc.src=e,this.state.blendFunc.dst=r,this.state.blendFunc.srcAlpha=s,this.state.blendFunc.dstAlpha=i,s!==void 0?this.gl.blendFuncSeparate(e,r,s,i):this.gl.blendFunc(e,r))}setBlendEquation(e,r){e=e||this.gl.FUNC_ADD,!(this.state.blendEquation.modeRGB===e&&this.state.blendEquation.modeAlpha===r)&&(this.state.blendEquation.modeRGB=e,this.state.blendEquation.modeAlpha=r,r!==void 0?this.gl.blendEquationSeparate(e,r):this.gl.blendEquation(e))}setCullFace(e){this.state.cullFace!==e&&(this.state.cullFace=e,this.gl.cullFace(e))}setFrontFace(e){this.state.frontFace!==e&&(this.state.frontFace=e,this.gl.frontFace(e))}setDepthMask(e){this.state.depthMask!==e&&(this.state.depthMask=e,this.gl.depthMask(e))}setDepthFunc(e){this.state.depthFunc!==e&&(this.state.depthFunc=e,this.gl.depthFunc(e))}setStencilMask(e){this.state.stencilMask!==e&&(this.state.stencilMask=e,this.gl.stencilMask(e))}setStencilFunc(e,r,s){this.state.stencilFunc===e&&this.state.stencilRef===r&&this.state.stencilFuncMask===s||(this.state.stencilFunc=e||this.gl.ALWAYS,this.state.stencilRef=r||0,this.state.stencilFuncMask=s||0,this.gl.stencilFunc(e||this.gl.ALWAYS,r||0,s||0))}setStencilOp(e,r,s){this.state.stencilFail===e&&this.state.stencilDepthFail===r&&this.state.stencilDepthPass===s||(this.state.stencilFail=e,this.state.stencilDepthFail=r,this.state.stencilDepthPass=s,this.gl.stencilOp(e,r,s))}activeTexture(e){this.state.activeTextureUnit!==e&&(this.state.activeTextureUnit=e,this.gl.activeTexture(this.gl.TEXTURE0+e))}bindFramebuffer({target:e=this.gl.FRAMEBUFFER,buffer:r=null}={}){this.state.framebuffer!==r&&(this.state.framebuffer=r,this.gl.bindFramebuffer(e,r))}getExtension(e,r,s){return r&&this.gl[r]?this.gl[r].bind(this.gl):(this.extensions[e]||(this.extensions[e]=this.gl.getExtension(e)),r?this.extensions[e]?this.extensions[e][s].bind(this.extensions[e]):null:this.extensions[e])}sortOpaque(e,r){return e.renderOrder!==r.renderOrder?e.renderOrder-r.renderOrder:e.program.id!==r.program.id?e.program.id-r.program.id:e.zDepth!==r.zDepth?e.zDepth-r.zDepth:r.id-e.id}sortTransparent(e,r){return e.renderOrder!==r.renderOrder?e.renderOrder-r.renderOrder:e.zDepth!==r.zDepth?r.zDepth-e.zDepth:r.id-e.id}sortUI(e,r){return e.renderOrder!==r.renderOrder?e.renderOrder-r.renderOrder:e.program.id!==r.program.id?e.program.id-r.program.id:r.id-e.id}getRenderList({scene:e,camera:r,frustumCull:s,sort:i}){let n=[];if(r&&s&&r.updateFrustum(),e.traverse(a=>{if(!a.visible)return!0;a.draw&&(s&&a.frustumCulled&&r&&!r.frustumIntersectsMesh(a)||n.push(a))}),i){const a=[],l=[],c=[];n.forEach(d=>{d.program.transparent?d.program.depthTest?l.push(d):c.push(d):a.push(d),d.zDepth=0,!(d.renderOrder!==0||!d.program.depthTest||!r)&&(d.worldMatrix.getTranslation(oe),oe.applyMatrix4(r.projectionViewMatrix),d.zDepth=oe.z)}),a.sort(this.sortOpaque),l.sort(this.sortTransparent),c.sort(this.sortUI),n=a.concat(l,c)}return n}render({scene:e,camera:r,target:s=null,update:i=!0,sort:n=!0,frustumCull:a=!0,clear:l}){s===null?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(s),this.setViewport(s.width,s.height)),(l||this.autoClear&&l!==!1)&&(this.depth&&(!s||s.depth)&&(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),(this.stencil||!s||s.stencil)&&(this.enable(this.gl.STENCIL_TEST),this.setStencilMask(255)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),i&&e.updateMatrixWorld(),r&&r.updateMatrixWorld(),this.getRenderList({scene:e,camera:r,frustumCull:a,sort:n}).forEach(d=>{d.draw({camera:r})})}}function qt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Vt(t,e,r,s,i){return t[0]=e,t[1]=r,t[2]=s,t[3]=i,t}function Ht(t,e){let r=e[0],s=e[1],i=e[2],n=e[3],a=r*r+s*s+i*i+n*n;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=s*a,t[2]=i*a,t[3]=n*a,t}function Gt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Yt(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Xt(t,e,r){r=r*.5;let s=Math.sin(r);return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=Math.cos(r),t}function Ne(t,e,r){let s=e[0],i=e[1],n=e[2],a=e[3],l=r[0],c=r[1],d=r[2],h=r[3];return t[0]=s*h+a*l+i*d-n*c,t[1]=i*h+a*c+n*l-s*d,t[2]=n*h+a*d+s*c-i*l,t[3]=a*h-s*l-i*c-n*d,t}function Qt(t,e,r){r*=.5;let s=e[0],i=e[1],n=e[2],a=e[3],l=Math.sin(r),c=Math.cos(r);return t[0]=s*c+a*l,t[1]=i*c+n*l,t[2]=n*c-i*l,t[3]=a*c-s*l,t}function Jt(t,e,r){r*=.5;let s=e[0],i=e[1],n=e[2],a=e[3],l=Math.sin(r),c=Math.cos(r);return t[0]=s*c-n*l,t[1]=i*c+a*l,t[2]=n*c+s*l,t[3]=a*c-i*l,t}function Zt(t,e,r){r*=.5;let s=e[0],i=e[1],n=e[2],a=e[3],l=Math.sin(r),c=Math.cos(r);return t[0]=s*c+i*l,t[1]=i*c-s*l,t[2]=n*c+a*l,t[3]=a*c-n*l,t}function Kt(t,e,r,s){let i=e[0],n=e[1],a=e[2],l=e[3],c=r[0],d=r[1],h=r[2],g=r[3],f,x,m,u,p;return x=i*c+n*d+a*h+l*g,x<0&&(x=-x,c=-c,d=-d,h=-h,g=-g),1-x>1e-6?(f=Math.acos(x),m=Math.sin(f),u=Math.sin((1-s)*f)/m,p=Math.sin(s*f)/m):(u=1-s,p=s),t[0]=u*i+p*c,t[1]=u*n+p*d,t[2]=u*a+p*h,t[3]=u*l+p*g,t}function er(t,e){let r=e[0],s=e[1],i=e[2],n=e[3],a=r*r+s*s+i*i+n*n,l=a?1/a:0;return t[0]=-r*l,t[1]=-s*l,t[2]=-i*l,t[3]=n*l,t}function tr(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function rr(t,e){let r=e[0]+e[4]+e[8],s;if(r>0)s=Math.sqrt(r+1),t[3]=.5*s,s=.5/s,t[0]=(e[5]-e[7])*s,t[1]=(e[6]-e[2])*s,t[2]=(e[1]-e[3])*s;else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);let n=(i+1)%3,a=(i+2)%3;s=Math.sqrt(e[i*3+i]-e[n*3+n]-e[a*3+a]+1),t[i]=.5*s,s=.5/s,t[3]=(e[n*3+a]-e[a*3+n])*s,t[n]=(e[n*3+i]+e[i*3+n])*s,t[a]=(e[a*3+i]+e[i*3+a])*s}return t}function sr(t,e,r="YXZ"){let s=Math.sin(e[0]*.5),i=Math.cos(e[0]*.5),n=Math.sin(e[1]*.5),a=Math.cos(e[1]*.5),l=Math.sin(e[2]*.5),c=Math.cos(e[2]*.5);return r==="XYZ"?(t[0]=s*a*c+i*n*l,t[1]=i*n*c-s*a*l,t[2]=i*a*l+s*n*c,t[3]=i*a*c-s*n*l):r==="YXZ"?(t[0]=s*a*c+i*n*l,t[1]=i*n*c-s*a*l,t[2]=i*a*l-s*n*c,t[3]=i*a*c+s*n*l):r==="ZXY"?(t[0]=s*a*c-i*n*l,t[1]=i*n*c+s*a*l,t[2]=i*a*l+s*n*c,t[3]=i*a*c-s*n*l):r==="ZYX"?(t[0]=s*a*c-i*n*l,t[1]=i*n*c+s*a*l,t[2]=i*a*l-s*n*c,t[3]=i*a*c+s*n*l):r==="YZX"?(t[0]=s*a*c+i*n*l,t[1]=i*n*c+s*a*l,t[2]=i*a*l-s*n*c,t[3]=i*a*c-s*n*l):r==="XZY"&&(t[0]=s*a*c-i*n*l,t[1]=i*n*c-s*a*l,t[2]=i*a*l+s*n*c,t[3]=i*a*c+s*n*l),t}const ir=qt,nr=Vt,ar=Gt,or=Ht;class lr extends Array{constructor(e=0,r=0,s=0,i=1){super(e,r,s,i),this.onChange=()=>{},this._target=this;const n=["0","1","2","3"];return new Proxy(this,{set(a,l){const c=Reflect.set(...arguments);return c&&n.includes(l)&&a.onChange(),c}})}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(e){this._target[0]=e,this.onChange()}set y(e){this._target[1]=e,this.onChange()}set z(e){this._target[2]=e,this.onChange()}set w(e){this._target[3]=e,this.onChange()}identity(){return Yt(this._target),this.onChange(),this}set(e,r,s,i){return e.length?this.copy(e):(nr(this._target,e,r,s,i),this.onChange(),this)}rotateX(e){return Qt(this._target,this._target,e),this.onChange(),this}rotateY(e){return Jt(this._target,this._target,e),this.onChange(),this}rotateZ(e){return Zt(this._target,this._target,e),this.onChange(),this}inverse(e=this._target){return er(this._target,e),this.onChange(),this}conjugate(e=this._target){return tr(this._target,e),this.onChange(),this}copy(e){return ir(this._target,e),this.onChange(),this}normalize(e=this._target){return or(this._target,e),this.onChange(),this}multiply(e,r){return r?Ne(this._target,e,r):Ne(this._target,this._target,e),this.onChange(),this}dot(e){return ar(this._target,e)}fromMatrix3(e){return rr(this._target,e),this.onChange(),this}fromEuler(e,r){return sr(this._target,e,e.order),r||this.onChange(),this}fromAxisAngle(e,r){return Xt(this._target,e,r),this.onChange(),this}slerp(e,r){return Kt(this._target,this._target,e,r),this.onChange(),this}fromArray(e,r=0){return this._target[0]=e[r],this._target[1]=e[r+1],this._target[2]=e[r+2],this._target[3]=e[r+3],this.onChange(),this}toArray(e=[],r=0){return e[r]=this[0],e[r+1]=this[1],e[r+2]=this[2],e[r+3]=this[3],e}}const cr=1e-6;function dr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function hr(t,e,r,s,i,n,a,l,c,d,h,g,f,x,m,u,p){return t[0]=e,t[1]=r,t[2]=s,t[3]=i,t[4]=n,t[5]=a,t[6]=l,t[7]=c,t[8]=d,t[9]=h,t[10]=g,t[11]=f,t[12]=x,t[13]=m,t[14]=u,t[15]=p,t}function ur(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function fr(t,e){let r=e[0],s=e[1],i=e[2],n=e[3],a=e[4],l=e[5],c=e[6],d=e[7],h=e[8],g=e[9],f=e[10],x=e[11],m=e[12],u=e[13],p=e[14],v=e[15],y=r*l-s*a,b=r*c-i*a,j=r*d-n*a,S=s*c-i*l,w=s*d-n*l,_=i*d-n*c,N=h*u-g*m,M=h*p-f*m,L=h*v-x*m,A=g*p-f*u,T=g*v-x*u,O=f*v-x*p,C=y*O-b*T+j*A+S*L-w*M+_*N;return C?(C=1/C,t[0]=(l*O-c*T+d*A)*C,t[1]=(i*T-s*O-n*A)*C,t[2]=(u*_-p*w+v*S)*C,t[3]=(f*w-g*_-x*S)*C,t[4]=(c*L-a*O-d*M)*C,t[5]=(r*O-i*L+n*M)*C,t[6]=(p*j-m*_-v*b)*C,t[7]=(h*_-f*j+x*b)*C,t[8]=(a*T-l*L+d*N)*C,t[9]=(s*L-r*T-n*N)*C,t[10]=(m*w-u*j+v*y)*C,t[11]=(g*j-h*w-x*y)*C,t[12]=(l*M-a*A-c*N)*C,t[13]=(r*A-s*M+i*N)*C,t[14]=(u*b-m*S-p*y)*C,t[15]=(h*S-g*b+f*y)*C,t):null}function qe(t){let e=t[0],r=t[1],s=t[2],i=t[3],n=t[4],a=t[5],l=t[6],c=t[7],d=t[8],h=t[9],g=t[10],f=t[11],x=t[12],m=t[13],u=t[14],p=t[15],v=e*a-r*n,y=e*l-s*n,b=e*c-i*n,j=r*l-s*a,S=r*c-i*a,w=s*c-i*l,_=d*m-h*x,N=d*u-g*x,M=d*p-f*x,L=h*u-g*m,A=h*p-f*m,T=g*p-f*u;return v*T-y*A+b*L+j*M-S*N+w*_}function Ae(t,e,r){let s=e[0],i=e[1],n=e[2],a=e[3],l=e[4],c=e[5],d=e[6],h=e[7],g=e[8],f=e[9],x=e[10],m=e[11],u=e[12],p=e[13],v=e[14],y=e[15],b=r[0],j=r[1],S=r[2],w=r[3];return t[0]=b*s+j*l+S*g+w*u,t[1]=b*i+j*c+S*f+w*p,t[2]=b*n+j*d+S*x+w*v,t[3]=b*a+j*h+S*m+w*y,b=r[4],j=r[5],S=r[6],w=r[7],t[4]=b*s+j*l+S*g+w*u,t[5]=b*i+j*c+S*f+w*p,t[6]=b*n+j*d+S*x+w*v,t[7]=b*a+j*h+S*m+w*y,b=r[8],j=r[9],S=r[10],w=r[11],t[8]=b*s+j*l+S*g+w*u,t[9]=b*i+j*c+S*f+w*p,t[10]=b*n+j*d+S*x+w*v,t[11]=b*a+j*h+S*m+w*y,b=r[12],j=r[13],S=r[14],w=r[15],t[12]=b*s+j*l+S*g+w*u,t[13]=b*i+j*c+S*f+w*p,t[14]=b*n+j*d+S*x+w*v,t[15]=b*a+j*h+S*m+w*y,t}function pr(t,e,r){let s=r[0],i=r[1],n=r[2],a,l,c,d,h,g,f,x,m,u,p,v;return e===t?(t[12]=e[0]*s+e[4]*i+e[8]*n+e[12],t[13]=e[1]*s+e[5]*i+e[9]*n+e[13],t[14]=e[2]*s+e[6]*i+e[10]*n+e[14],t[15]=e[3]*s+e[7]*i+e[11]*n+e[15]):(a=e[0],l=e[1],c=e[2],d=e[3],h=e[4],g=e[5],f=e[6],x=e[7],m=e[8],u=e[9],p=e[10],v=e[11],t[0]=a,t[1]=l,t[2]=c,t[3]=d,t[4]=h,t[5]=g,t[6]=f,t[7]=x,t[8]=m,t[9]=u,t[10]=p,t[11]=v,t[12]=a*s+h*i+m*n+e[12],t[13]=l*s+g*i+u*n+e[13],t[14]=c*s+f*i+p*n+e[14],t[15]=d*s+x*i+v*n+e[15]),t}function mr(t,e,r){let s=r[0],i=r[1],n=r[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function gr(t,e,r,s){let i=s[0],n=s[1],a=s[2],l=Math.hypot(i,n,a),c,d,h,g,f,x,m,u,p,v,y,b,j,S,w,_,N,M,L,A,T,O,C,U;return Math.abs(l)<cr?null:(l=1/l,i*=l,n*=l,a*=l,c=Math.sin(r),d=Math.cos(r),h=1-d,g=e[0],f=e[1],x=e[2],m=e[3],u=e[4],p=e[5],v=e[6],y=e[7],b=e[8],j=e[9],S=e[10],w=e[11],_=i*i*h+d,N=n*i*h+a*c,M=a*i*h-n*c,L=i*n*h-a*c,A=n*n*h+d,T=a*n*h+i*c,O=i*a*h+n*c,C=n*a*h-i*c,U=a*a*h+d,t[0]=g*_+u*N+b*M,t[1]=f*_+p*N+j*M,t[2]=x*_+v*N+S*M,t[3]=m*_+y*N+w*M,t[4]=g*L+u*A+b*T,t[5]=f*L+p*A+j*T,t[6]=x*L+v*A+S*T,t[7]=m*L+y*A+w*T,t[8]=g*O+u*C+b*U,t[9]=f*O+p*C+j*U,t[10]=x*O+v*C+S*U,t[11]=m*O+y*C+w*U,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function xr(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Ve(t,e){let r=e[0],s=e[1],i=e[2],n=e[4],a=e[5],l=e[6],c=e[8],d=e[9],h=e[10];return t[0]=Math.hypot(r,s,i),t[1]=Math.hypot(n,a,l),t[2]=Math.hypot(c,d,h),t}function vr(t){let e=t[0],r=t[1],s=t[2],i=t[4],n=t[5],a=t[6],l=t[8],c=t[9],d=t[10];const h=e*e+r*r+s*s,g=i*i+n*n+a*a,f=l*l+c*c+d*d;return Math.sqrt(Math.max(h,g,f))}const He=function(){const t=[1,1,1];return function(e,r){let s=t;Ve(s,r);let i=1/s[0],n=1/s[1],a=1/s[2],l=r[0]*i,c=r[1]*n,d=r[2]*a,h=r[4]*i,g=r[5]*n,f=r[6]*a,x=r[8]*i,m=r[9]*n,u=r[10]*a,p=l+g+u,v=0;return p>0?(v=Math.sqrt(p+1)*2,e[3]=.25*v,e[0]=(f-m)/v,e[1]=(x-d)/v,e[2]=(c-h)/v):l>g&&l>u?(v=Math.sqrt(1+l-g-u)*2,e[3]=(f-m)/v,e[0]=.25*v,e[1]=(c+h)/v,e[2]=(x+d)/v):g>u?(v=Math.sqrt(1+g-l-u)*2,e[3]=(x-d)/v,e[0]=(c+h)/v,e[1]=.25*v,e[2]=(f+m)/v):(v=Math.sqrt(1+u-l-g)*2,e[3]=(c-h)/v,e[0]=(x+d)/v,e[1]=(f+m)/v,e[2]=.25*v),e}}();function yr(t,e,r,s){let i=$([t[0],t[1],t[2]]);const n=$([t[4],t[5],t[6]]),a=$([t[8],t[9],t[10]]);qe(t)<0&&(i=-i),r[0]=t[12],r[1]=t[13],r[2]=t[14];const c=t.slice(),d=1/i,h=1/n,g=1/a;c[0]*=d,c[1]*=d,c[2]*=d,c[4]*=h,c[5]*=h,c[6]*=h,c[8]*=g,c[9]*=g,c[10]*=g,He(e,c),s[0]=i,s[1]=n,s[2]=a}function br(t,e,r,s){const i=t,n=e[0],a=e[1],l=e[2],c=e[3],d=n+n,h=a+a,g=l+l,f=n*d,x=n*h,m=n*g,u=a*h,p=a*g,v=l*g,y=c*d,b=c*h,j=c*g,S=s[0],w=s[1],_=s[2];return i[0]=(1-(u+v))*S,i[1]=(x+j)*S,i[2]=(m-b)*S,i[3]=0,i[4]=(x-j)*w,i[5]=(1-(f+v))*w,i[6]=(p+y)*w,i[7]=0,i[8]=(m+b)*_,i[9]=(p-y)*_,i[10]=(1-(f+u))*_,i[11]=0,i[12]=r[0],i[13]=r[1],i[14]=r[2],i[15]=1,i}function wr(t,e){let r=e[0],s=e[1],i=e[2],n=e[3],a=r+r,l=s+s,c=i+i,d=r*a,h=s*a,g=s*l,f=i*a,x=i*l,m=i*c,u=n*a,p=n*l,v=n*c;return t[0]=1-g-m,t[1]=h+v,t[2]=f-p,t[3]=0,t[4]=h-v,t[5]=1-d-m,t[6]=x+u,t[7]=0,t[8]=f+p,t[9]=x-u,t[10]=1-d-g,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _r(t,e,r,s,i){let n=1/Math.tan(e/2),a=1/(s-i);return t[0]=n/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+s)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*s*a,t[15]=0,t}function jr(t,e,r,s,i,n,a){let l=1/(e-r),c=1/(s-i),d=1/(n-a);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*d,t[11]=0,t[12]=(e+r)*l,t[13]=(i+s)*c,t[14]=(a+n)*d,t[15]=1,t}function Sr(t,e,r,s){let i=e[0],n=e[1],a=e[2],l=s[0],c=s[1],d=s[2],h=i-r[0],g=n-r[1],f=a-r[2],x=h*h+g*g+f*f;x===0?f=1:(x=1/Math.sqrt(x),h*=x,g*=x,f*=x);let m=c*f-d*g,u=d*h-l*f,p=l*g-c*h;return x=m*m+u*u+p*p,x===0&&(d?l+=1e-6:c?d+=1e-6:c+=1e-6,m=c*f-d*g,u=d*h-l*f,p=l*g-c*h,x=m*m+u*u+p*p),x=1/Math.sqrt(x),m*=x,u*=x,p*=x,t[0]=m,t[1]=u,t[2]=p,t[3]=0,t[4]=g*p-f*u,t[5]=f*m-h*p,t[6]=h*u-g*m,t[7]=0,t[8]=h,t[9]=g,t[10]=f,t[11]=0,t[12]=i,t[13]=n,t[14]=a,t[15]=1,t}function Le(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function Te(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function Cr(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}class J extends Array{constructor(e=1,r=0,s=0,i=0,n=0,a=1,l=0,c=0,d=0,h=0,g=1,f=0,x=0,m=0,u=0,p=1){return super(e,r,s,i,n,a,l,c,d,h,g,f,x,m,u,p),this}get x(){return this[12]}get y(){return this[13]}get z(){return this[14]}get w(){return this[15]}set x(e){this[12]=e}set y(e){this[13]=e}set z(e){this[14]=e}set w(e){this[15]=e}set(e,r,s,i,n,a,l,c,d,h,g,f,x,m,u,p){return e.length?this.copy(e):(hr(this,e,r,s,i,n,a,l,c,d,h,g,f,x,m,u,p),this)}translate(e,r=this){return pr(this,r,e),this}rotate(e,r,s=this){return gr(this,s,e,r),this}scale(e,r=this){return mr(this,r,typeof e=="number"?[e,e,e]:e),this}add(e,r){return r?Le(this,e,r):Le(this,this,e),this}sub(e,r){return r?Te(this,e,r):Te(this,this,e),this}multiply(e,r){return e.length?r?Ae(this,e,r):Ae(this,this,e):Cr(this,this,e),this}identity(){return ur(this),this}copy(e){return dr(this,e),this}fromPerspective({fov:e,aspect:r,near:s,far:i}={}){return _r(this,e,r,s,i),this}fromOrthogonal({left:e,right:r,bottom:s,top:i,near:n,far:a}){return jr(this,e,r,s,i,n,a),this}fromQuaternion(e){return wr(this,e),this}setPosition(e){return this.x=e[0],this.y=e[1],this.z=e[2],this}inverse(e=this){return fr(this,e),this}compose(e,r,s){return br(this,e,r,s),this}decompose(e,r,s){return yr(this,e,r,s),this}getRotation(e){return He(e,this),this}getTranslation(e){return xr(e,this),this}getScaling(e){return Ve(e,this),this}getMaxScaleOnAxis(){return vr(this)}lookAt(e,r,s){return Sr(this,e,r,s),this}determinant(){return qe(this)}fromArray(e,r=0){return this[0]=e[r],this[1]=e[r+1],this[2]=e[r+2],this[3]=e[r+3],this[4]=e[r+4],this[5]=e[r+5],this[6]=e[r+6],this[7]=e[r+7],this[8]=e[r+8],this[9]=e[r+9],this[10]=e[r+10],this[11]=e[r+11],this[12]=e[r+12],this[13]=e[r+13],this[14]=e[r+14],this[15]=e[r+15],this}toArray(e=[],r=0){return e[r]=this[0],e[r+1]=this[1],e[r+2]=this[2],e[r+3]=this[3],e[r+4]=this[4],e[r+5]=this[5],e[r+6]=this[6],e[r+7]=this[7],e[r+8]=this[8],e[r+9]=this[9],e[r+10]=this[10],e[r+11]=this[11],e[r+12]=this[12],e[r+13]=this[13],e[r+14]=this[14],e[r+15]=this[15],e}}function Er(t,e,r="YXZ"){return r==="XYZ"?(t[1]=Math.asin(Math.min(Math.max(e[8],-1),1)),Math.abs(e[8])<.99999?(t[0]=Math.atan2(-e[9],e[10]),t[2]=Math.atan2(-e[4],e[0])):(t[0]=Math.atan2(e[6],e[5]),t[2]=0)):r==="YXZ"?(t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0)):r==="ZXY"?(t[0]=Math.asin(Math.min(Math.max(e[6],-1),1)),Math.abs(e[6])<.99999?(t[1]=Math.atan2(-e[2],e[10]),t[2]=Math.atan2(-e[4],e[5])):(t[1]=0,t[2]=Math.atan2(e[1],e[0]))):r==="ZYX"?(t[1]=Math.asin(-Math.min(Math.max(e[2],-1),1)),Math.abs(e[2])<.99999?(t[0]=Math.atan2(e[6],e[10]),t[2]=Math.atan2(e[1],e[0])):(t[0]=0,t[2]=Math.atan2(-e[4],e[5]))):r==="YZX"?(t[2]=Math.asin(Math.min(Math.max(e[1],-1),1)),Math.abs(e[1])<.99999?(t[0]=Math.atan2(-e[9],e[5]),t[1]=Math.atan2(-e[2],e[0])):(t[0]=0,t[1]=Math.atan2(e[8],e[10]))):r==="XZY"&&(t[2]=Math.asin(-Math.min(Math.max(e[4],-1),1)),Math.abs(e[4])<.99999?(t[0]=Math.atan2(e[6],e[5]),t[1]=Math.atan2(e[8],e[0])):(t[0]=Math.atan2(-e[9],e[10]),t[1]=0)),t}const Oe=new J;class Mr extends Array{constructor(e=0,r=e,s=e,i="YXZ"){super(e,r,s),this.order=i,this.onChange=()=>{},this._target=this;const n=["0","1","2"];return new Proxy(this,{set(a,l){const c=Reflect.set(...arguments);return c&&n.includes(l)&&a.onChange(),c}})}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(e){this._target[0]=e,this.onChange()}set y(e){this._target[1]=e,this.onChange()}set z(e){this._target[2]=e,this.onChange()}set(e,r=e,s=e){return e.length?this.copy(e):(this._target[0]=e,this._target[1]=r,this._target[2]=s,this.onChange(),this)}copy(e){return this._target[0]=e[0],this._target[1]=e[1],this._target[2]=e[2],this.onChange(),this}reorder(e){return this._target.order=e,this.onChange(),this}fromRotationMatrix(e,r=this.order){return Er(this._target,e,r),this.onChange(),this}fromQuaternion(e,r=this.order,s){return Oe.fromQuaternion(e),this._target.fromRotationMatrix(Oe,r),s||this.onChange(),this}fromArray(e,r=0){return this._target[0]=e[r],this._target[1]=e[r+1],this._target[2]=e[r+2],this}toArray(e=[],r=0){return e[r]=this[0],e[r+1]=this[1],e[r+2]=this[2],e}}class kr{constructor(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new J,this.worldMatrix=new J,this.matrixAutoUpdate=!0,this.worldMatrixNeedsUpdate=!1,this.position=new I,this.quaternion=new lr,this.scale=new I(1),this.rotation=new Mr,this.up=new I(0,1,0),this.rotation._target.onChange=()=>this.quaternion.fromEuler(this.rotation,!0),this.quaternion._target.onChange=()=>this.rotation.fromQuaternion(this.quaternion,void 0,!0)}setParent(e,r=!0){this.parent&&e!==this.parent&&this.parent.removeChild(this,!1),this.parent=e,r&&e&&e.addChild(this,!1)}addChild(e,r=!0){~this.children.indexOf(e)||this.children.push(e),r&&e.setParent(this,!1)}removeChild(e,r=!0){~this.children.indexOf(e)&&this.children.splice(this.children.indexOf(e),1),r&&e.setParent(null,!1)}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||e)&&(this.parent===null?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,e=!0);for(let r=0,s=this.children.length;r<s;r++)this.children[r].updateMatrixWorld(e)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(e){if(!e(this))for(let r=0,s=this.children.length;r<s;r++)this.children[r].traverse(e)}decompose(){this.matrix.decompose(this.quaternion._target,this.position,this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(e,r=!1){r?this.matrix.lookAt(this.position,e,this.up):this.matrix.lookAt(e,this.position,this.up),this.matrix.getRotation(this.quaternion._target),this.rotation.fromQuaternion(this.quaternion)}}function Nr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Ar(t,e){let r=e[0],s=e[1],i=e[2],n=e[3],a=r+r,l=s+s,c=i+i,d=r*a,h=s*a,g=s*l,f=i*a,x=i*l,m=i*c,u=n*a,p=n*l,v=n*c;return t[0]=1-g-m,t[3]=h-v,t[6]=f+p,t[1]=h+v,t[4]=1-d-m,t[7]=x-u,t[2]=f-p,t[5]=x+u,t[8]=1-d-g,t}function Lr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Tr(t,e,r,s,i,n,a,l,c,d){return t[0]=e,t[1]=r,t[2]=s,t[3]=i,t[4]=n,t[5]=a,t[6]=l,t[7]=c,t[8]=d,t}function Or(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Ir(t,e){let r=e[0],s=e[1],i=e[2],n=e[3],a=e[4],l=e[5],c=e[6],d=e[7],h=e[8],g=h*a-l*d,f=-h*n+l*c,x=d*n-a*c,m=r*g+s*f+i*x;return m?(m=1/m,t[0]=g*m,t[1]=(-h*s+i*d)*m,t[2]=(l*s-i*a)*m,t[3]=f*m,t[4]=(h*r-i*c)*m,t[5]=(-l*r+i*n)*m,t[6]=x*m,t[7]=(-d*r+s*c)*m,t[8]=(a*r-s*n)*m,t):null}function Ie(t,e,r){let s=e[0],i=e[1],n=e[2],a=e[3],l=e[4],c=e[5],d=e[6],h=e[7],g=e[8],f=r[0],x=r[1],m=r[2],u=r[3],p=r[4],v=r[5],y=r[6],b=r[7],j=r[8];return t[0]=f*s+x*a+m*d,t[1]=f*i+x*l+m*h,t[2]=f*n+x*c+m*g,t[3]=u*s+p*a+v*d,t[4]=u*i+p*l+v*h,t[5]=u*n+p*c+v*g,t[6]=y*s+b*a+j*d,t[7]=y*i+b*l+j*h,t[8]=y*n+b*c+j*g,t}function Rr(t,e,r){let s=e[0],i=e[1],n=e[2],a=e[3],l=e[4],c=e[5],d=e[6],h=e[7],g=e[8],f=r[0],x=r[1];return t[0]=s,t[1]=i,t[2]=n,t[3]=a,t[4]=l,t[5]=c,t[6]=f*s+x*a+d,t[7]=f*i+x*l+h,t[8]=f*n+x*c+g,t}function Dr(t,e,r){let s=e[0],i=e[1],n=e[2],a=e[3],l=e[4],c=e[5],d=e[6],h=e[7],g=e[8],f=Math.sin(r),x=Math.cos(r);return t[0]=x*s+f*a,t[1]=x*i+f*l,t[2]=x*n+f*c,t[3]=x*a-f*s,t[4]=x*l-f*i,t[5]=x*c-f*n,t[6]=d,t[7]=h,t[8]=g,t}function zr(t,e,r){let s=r[0],i=r[1];return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Fr(t,e){let r=e[0],s=e[1],i=e[2],n=e[3],a=e[4],l=e[5],c=e[6],d=e[7],h=e[8],g=e[9],f=e[10],x=e[11],m=e[12],u=e[13],p=e[14],v=e[15],y=r*l-s*a,b=r*c-i*a,j=r*d-n*a,S=s*c-i*l,w=s*d-n*l,_=i*d-n*c,N=h*u-g*m,M=h*p-f*m,L=h*v-x*m,A=g*p-f*u,T=g*v-x*u,O=f*v-x*p,C=y*O-b*T+j*A+S*L-w*M+_*N;return C?(C=1/C,t[0]=(l*O-c*T+d*A)*C,t[1]=(c*L-a*O-d*M)*C,t[2]=(a*T-l*L+d*N)*C,t[3]=(i*T-s*O-n*A)*C,t[4]=(r*O-i*L+n*M)*C,t[5]=(s*L-r*T-n*N)*C,t[6]=(u*_-p*w+v*S)*C,t[7]=(p*j-m*_-v*b)*C,t[8]=(m*w-u*j+v*y)*C,t):null}class Pr extends Array{constructor(e=1,r=0,s=0,i=0,n=1,a=0,l=0,c=0,d=1){return super(e,r,s,i,n,a,l,c,d),this}set(e,r,s,i,n,a,l,c,d){return e.length?this.copy(e):(Tr(this,e,r,s,i,n,a,l,c,d),this)}translate(e,r=this){return Rr(this,r,e),this}rotate(e,r=this){return Dr(this,r,e),this}scale(e,r=this){return zr(this,r,e),this}multiply(e,r){return r?Ie(this,e,r):Ie(this,this,e),this}identity(){return Or(this),this}copy(e){return Lr(this,e),this}fromMatrix4(e){return Nr(this,e),this}fromQuaternion(e){return Ar(this,e),this}fromBasis(e,r,s){return this.set(e[0],e[1],e[2],r[0],r[1],r[2],s[0],s[1],s[2]),this}inverse(e=this){return Ir(this,e),this}getNormalMatrix(e){return Fr(this,e),this}}let Ur=0;class Br extends kr{constructor(e,{geometry:r,program:s,mode:i=e.TRIANGLES,frustumCulled:n=!0,renderOrder:a=0}={}){super(),e.canvas||console.error("gl not passed as first argument to Mesh"),this.gl=e,this.id=Ur++,this.geometry=r,this.program=s,this.mode=i,this.frustumCulled=n,this.renderOrder=a,this.modelViewMatrix=new J,this.normalMatrix=new Pr,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}onBeforeRender(e){return this.beforeRenderCallbacks.push(e),this}onAfterRender(e){return this.afterRenderCallbacks.push(e),this}draw({camera:e}={}){e&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=e.projectionMatrix,this.program.uniforms.cameraPosition.value=e.worldPosition,this.program.uniforms.viewMatrix.value=e.viewMatrix,this.modelViewMatrix.multiply(e.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix),this.beforeRenderCallbacks.forEach(s=>s&&s({mesh:this,camera:e}));let r=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:r}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach(s=>s&&s({mesh:this,camera:e}))}}class $r extends Dt{constructor(e,{attributes:r={}}={}){Object.assign(r,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),super(e,r)}}const Re={violet:"#8b5cf6",blue:"#3b82f6",green:"#10b981",rose:"#f43f5e",orange:"#f97316"},De=t=>{const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?[parseInt(e[1],16)/255,parseInt(e[2],16)/255,parseInt(e[3],16)/255]:[1,.5,.2]},Wr=`#version 300 es
precision highp float;
in vec2 position;
in vec2 uv;
out vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = vec4(position, 0.0, 1.0);
}
`,qr=`#version 300 es
precision mediump float;
uniform vec2 iResolution;
uniform float iTime;
uniform vec3 uCustomColor;
uniform float uUseCustomColor;
uniform float uSpeed;
uniform float uDirection;
uniform float uScale;
uniform float uOpacity;
uniform vec2 uMouse;
uniform float uMouseInteractive;
out vec4 fragColor;

void mainImage(out vec4 o, vec2 C) {
  vec2 center = iResolution.xy * 0.5;
  C = (C - center) / uScale + center;

  vec2 mouseOffset = (uMouse - center) * 0.0002;
  C += mouseOffset * length(C - center) * step(0.5, uMouseInteractive);

  float i, d, z, T = iTime * uSpeed * uDirection;
  vec3 O, p, S;

  // 30 iterations for better performance during UI transitions
  for (vec2 r = iResolution.xy, Q; ++i < 30.; O += o.w/d*o.xyz) {
    p = z*normalize(vec3(C-.5*r,r.y));
    p.z -= 4.;
    S = p;
    d = p.y-T;

    p.x += .4*(1.+p.y)*sin(d + p.x*0.1)*cos(.34*d + p.x*0.05);
    Q = p.xz *= mat2(cos(p.y+vec4(0,11,33,0)-T));
    z+= d = abs(sqrt(length(Q*Q)) - .25*(5.+S.y))/3.+8e-4;
    o = 1.+sin(S.y+p.z*.5+S.z-length(S-p)+vec4(2,1,0,8));
  }

  o.xyz = tanh(O/1e4);
}

bool finite1(float x){ return !(isnan(x) || isinf(x)); }
vec3 sanitize(vec3 c){
  return vec3(
    finite1(c.r) ? c.r : 0.0,
    finite1(c.g) ? c.g : 0.0,
    finite1(c.b) ? c.b : 0.0
  );
}

void main() {
  vec4 o = vec4(0.0);
  mainImage(o, gl_FragCoord.xy);
  vec3 rgb = sanitize(o.rgb);

  float intensity = (rgb.r + rgb.g + rgb.b) / 3.0;
  vec3 customColor = intensity * uCustomColor;
  vec3 finalColor = mix(rgb, customColor, step(0.5, uUseCustomColor));

  float alpha = length(rgb) * uOpacity;
  fragColor = vec4(finalColor, alpha);
}`;function Vr(){try{const t=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("webgl2")))}catch{return!1}}function Hr(){const t=E.useRef(null);return E.useEffect(()=>{if(!t.current)return;const e=t.current;if(!Vr()){console.warn("WebGL not supported, skipping plasma background");return}const r=Re[D.getState().settings.colorScheme]||"#8b5cf6",s=De(r),i=window.innerWidth<768;let n;try{n=new Wt({webgl:2,alpha:!0,antialias:!1,dpr:i?.35:.5})}catch(_){console.warn("Failed to create WebGL renderer:",_);return}const a=n.gl,l=a.canvas;l.style.display="block",l.style.width="100%",l.style.height="100%",e.appendChild(l);const c=new $r(a),d=new Ft(a,{vertex:Wr,fragment:qr,uniforms:{iTime:{value:0},iResolution:{value:new Float32Array([1,1])},uCustomColor:{value:new Float32Array(s)},uUseCustomColor:{value:1},uSpeed:{value:.5*.4},uDirection:{value:1},uScale:{value:1.1},uOpacity:{value:.6},uMouse:{value:new Float32Array([0,0])},uMouseInteractive:{value:1}}}),h=new Br(a,{geometry:c,program:d});let g=D.getState().settings.colorScheme;D.subscribe(_=>{const N=_.settings.colorScheme;if(N!==g){g=N;const M=Re[N]||"#8b5cf6",L=De(M),A=d.uniforms.uCustomColor.value;A[0]=L[0],A[1]=L[1],A[2]=L[2]}});const f={x:0,y:0},x=_=>{if(!t.current)return;const N=t.current.getBoundingClientRect();f.x=_.clientX-N.left,f.y=_.clientY-N.top;const M=d.uniforms.uMouse.value;M[0]=f.x,M[1]=f.y};e.addEventListener("mousemove",x);const m=()=>{if(!t.current)return;const _=t.current.getBoundingClientRect(),N=Math.max(1,Math.floor(_.width)),M=Math.max(1,Math.floor(_.height));n.setSize(N,M);const L=d.uniforms.iResolution.value;L[0]=a.drawingBufferWidth,L[1]=a.drawingBufferHeight};new ResizeObserver(m).observe(e),m();const v=1e3/(i?20:24);let y=0;const b=performance.now();let j=!0;const S=()=>{j=!document.hidden};document.addEventListener("visibilitychange",S);const w=_=>{if(requestAnimationFrame(w),!j)return;const N=_-y;if(N<v)return;y=_-N%v;const M=(_-b)*.001;d.uniforms.iTime.value=M,n.render({scene:h})};requestAnimationFrame(w)},[]),o.jsx("div",{ref:t,className:"fixed inset-0 pointer-events-none no-print",style:{zIndex:-1,overflow:"hidden"}})}const Gr=E.memo(function({onLoginSuccess:e}){const[r,s]=E.useState(""),[i,n]=E.useState(""),[a,l]=E.useState(""),[c,d]=E.useState(!1),[h,g]=E.useState(!1),f=$e(m=>m.login),x=async m=>{m.preventDefault(),l(""),d(!0),await f(r,i)?(g(!0),setTimeout(()=>{e==null||e()},500)):(l("Identifiants invalides"),d(!1))};return o.jsx("div",{className:`min-h-screen flex items-center justify-center p-4 transition-opacity duration-500 ${h?"opacity-0":"opacity-100"}`,children:o.jsxs("div",{className:`rounded-2xl shadow-2xl p-8 w-full max-w-md border border-[var(--glass-border)] backdrop-blur-xl transition-all duration-500 ${h?"scale-95 opacity-0":"scale-100 opacity-100"}`,style:{background:"var(--glass-bg)"},children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h1",{className:"text-3xl font-bold text-[var(--text-main)] mb-2",children:"Moodix"}),o.jsx("p",{className:"text-[var(--text-secondary)] text-sm",children:"Connectez-vous pour accéder à votre journal"})]}),o.jsxs("form",{onSubmit:m=>void x(m),className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"username",className:"block text-sm font-bold text-[var(--text-main)] mb-2",children:"Nom d'utilisateur"}),o.jsx("input",{id:"username",type:"text",value:r,onChange:m=>s(m.target.value),className:"w-full px-4 py-3 bg-input rounded-xl text-[var(--text-main)] border border-[var(--border)] focus:outline-none focus:ring-2 focus:ring-[var(--primary)]/50 focus:border-transparent transition",placeholder:"admin",required:!0,autoFocus:!0,autoComplete:"username","aria-describedby":a?"login-error":void 0})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"password",className:"block text-sm font-bold text-[var(--text-main)] mb-2",children:"Mot de passe"}),o.jsx("input",{id:"password",type:"password",value:i,onChange:m=>n(m.target.value),className:"w-full px-4 py-3 bg-input rounded-xl text-[var(--text-main)] border border-[var(--border)] focus:outline-none focus:ring-2 focus:ring-[var(--primary)]/50 focus:border-transparent transition",placeholder:"••••••••",required:!0,autoComplete:"current-password"})]}),a&&o.jsx("div",{id:"login-error",className:"bg-red-500/10 text-red-400 px-4 py-3 rounded-xl text-sm shadow-lg shadow-red-500/10",role:"alert",children:a}),o.jsx("button",{type:"submit",disabled:c,className:"w-full bg-gradient-to-r from-[var(--primary)] to-[var(--primary-dark)] hover:from-[var(--primary-dark)] hover:to-[var(--primary)] disabled:from-[var(--bg-card)] disabled:to-[var(--bg-card)] disabled:opacity-50 text-white font-bold py-3 px-4 rounded-xl transition duration-200 flex items-center justify-center gap-2 shadow-lg shadow-[var(--primary)]/30","aria-busy":c,children:c?o.jsxs(o.Fragment,{children:[o.jsx(k.Loading,{className:"animate-spin h-5 w-5"}),"Connexion..."]}):"Se connecter"})]})]})})});function Yr(){var n,a,l,c;const{entries:t}=he(),{settings:e}=D(),{printConfig:r,printSelectedDates:s}=P(),i=d=>ue(e.lang,d);return o.jsxs("div",{className:"print-only p-4 print-reset-bg",children:[r.sleep&&o.jsxs(o.Fragment,{children:[o.jsx("h1",{className:"text-2xl font-bold text-center mb-1 print-reset-text",children:i("print_title_sleep")}),o.jsxs("div",{className:"flex justify-center gap-5 mb-3 text-[10px] uppercase font-bold text-[var(--text-muted)] print-reset-text border-b pb-2 mx-auto w-3/4",children:[o.jsxs("span",{children:["A = ",(n=e.consumables.find(d=>d.key==="cannabis"))==null?void 0:n.label]}),o.jsxs("span",{children:["C = ",(a=e.consumables.find(d=>d.key==="caffeine"))==null?void 0:a.label]}),o.jsxs("span",{children:["M = ",(l=e.consumables.find(d=>d.key==="medication"))==null?void 0:l.label]}),o.jsxs("span",{children:["E = ",(c=e.consumables.find(d=>d.key==="exercise"))==null?void 0:c.label]})]}),o.jsxs("table",{className:"w-full border-collapse print-grid mb-8",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:"8%"},children:"Date"}),dt.map((d,h)=>o.jsx("th",{children:d},h))]})}),o.jsx("tbody",{children:Object.keys(t).sort().map(d=>{const h=t[d],g=new Date(d).toLocaleDateString(e.lang==="fr"?"fr-FR":"en-US",{weekday:"long"});return o.jsxs("tr",{children:[o.jsxs("td",{className:"text-left pl-1 relative",children:[o.jsxs("div",{className:"font-bold",children:[new Date(d).getDate(),"/",new Date(d).getMonth()+1]}),o.jsx("div",{className:"text-[9px] uppercase",children:g.slice(0,3)})]}),(h.sleepHours||[]).map((f,x)=>{const m=Array.isArray(h.bedtime)?h.bedtime:h.bedtime?[h.bedtime]:[],u=Array.isArray(h.wakeup)?h.wakeup:h.wakeup?[h.wakeup]:[],p=m.some(w=>F(w,x)),v=u.some(w=>F(w,x)),y=(h.caffeine||[]).filter(w=>{const _=typeof w=="string"?null:w.time;return _&&F(_,x)}).length,b=(h.exercise||[]).filter(w=>{const _=typeof w=="string"?null:w.time;return _&&F(_,x)}).length,j=(h.medication||[]).filter(w=>{const _=typeof w=="string"?null:w.time;return _&&F(_,x)}).length,S=(h.cannabis||[]).filter(w=>{const _=typeof w=="string"?null:w.time;return _&&F(_,x)}).length;return o.jsx("td",{className:f?"cell-sleep":"",children:o.jsxs("div",{className:"cell-content",children:[p&&o.jsx("span",{className:"arrow-symbol",children:"↓"})," ",v&&o.jsx("span",{className:"arrow-symbol",children:"↑"}),y>0&&o.jsx("span",{className:"letter-symbol",children:"C"})," ",j>0&&o.jsx("span",{className:"letter-symbol",children:"M"}),b>0&&o.jsx("span",{className:"letter-symbol",children:"E"})," ",S>0&&o.jsx("span",{className:"letter-symbol",children:S>1?`A${S}`:"A"})]})},x)})]},d)})})]})]}),[...s].sort().map(d=>{const h=t[d];if(!h)return null;const g=h.activityLog||[],f=r.activities&&g.some(m=>m.activities&&m.activities.length>0),x=r.cycles&&h.viciousCycles&&h.viciousCycles.length>0;return!f&&!x?null:o.jsxs("div",{className:"page-break print-reset-text",children:[o.jsxs("h1",{className:"text-xl font-bold text-center mt-4 mb-2",children:[i("print_title_act")," -"," ",new Date(d).toLocaleDateString(e.lang==="fr"?"fr-FR":"en-US",{weekday:"long",day:"numeric",month:"long",year:"numeric"})]}),f&&o.jsxs(o.Fragment,{children:[o.jsxs("table",{className:"activity-print-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{className:"w-16",children:"Heure"}),o.jsx("th",{children:i("print_act")}),o.jsx("th",{className:"w-12",children:"P"}),o.jsx("th",{className:"w-12",children:"M"}),o.jsx("th",{className:"w-12",children:"S"})]})}),o.jsx("tbody",{children:g.map(m=>o.jsxs("tr",{children:[o.jsx("td",{className:"text-center font-bold",children:m.slot}),o.jsx("td",{children:o.jsx("strong",{children:m.activities.map(u=>u.name).join(" - ")})}),o.jsx("td",{className:"text-center",children:m.activities.map(u=>u.plaisir).join(" - ")}),o.jsx("td",{className:"text-center",children:m.activities.map(u=>u.maitrise).join(" - ")}),o.jsx("td",{className:"text-center",children:m.activities.map(u=>u.satisfaction).join(" - ")})]},m.slot))})]}),o.jsxs("div",{className:"mt-4 flex gap-4",children:[o.jsxs("div",{className:"border p-2 text-center font-bold flex-1",children:[i("mood_title")," : ",h.generalMood,"/10"]}),h.thoughts&&o.jsxs("div",{className:"border p-2 text-sm italic flex-[3]",children:['"',h.thoughts,'"']})]})]}),x&&o.jsxs("div",{className:f?"page-break":"mt-6",children:[o.jsx("h2",{className:"text-sm font-bold uppercase mb-2 border-b",children:i("cycles_header")}),o.jsxs("table",{className:"cycle-print-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:"20%"},children:i("situation_label")}),o.jsx("th",{style:{width:"15%"},children:i("emotions_label")}),o.jsx("th",{style:{width:"20%"},children:i("thoughts_label")}),o.jsx("th",{style:{width:"20%"},children:i("behaviors_label")}),o.jsx("th",{style:{width:"25%"},children:i("consequences_label")})]})}),o.jsx("tbody",{children:h.viciousCycles.map(m=>o.jsxs("tr",{children:[o.jsx("td",{children:m.situation}),o.jsx("td",{children:m.emotions.map((u,p)=>o.jsxs("div",{className:"cycle-list-item",children:["• ",u.name," ",o.jsxs("strong",{children:["(",u.score,")"]})]},p))}),o.jsx("td",{children:m.thoughts.map((u,p)=>o.jsxs("div",{className:"cycle-list-item",children:["• ",u.text]},p))}),o.jsx("td",{children:m.behaviors.map((u,p)=>o.jsxs("div",{className:"cycle-list-item",children:["• ",u.text]},p))}),o.jsx("td",{children:m.consequences.map((u,p)=>o.jsxs("div",{className:"cycle-list-item",children:["• ",u.text]},p))})]},m.id))})]})]})]},d)})]})}const Xr=E.lazy(()=>q(()=>import("./SleepTab-BKELj5Ue.js"),__vite__mapDeps([0,1,2]))),Qr=E.lazy(()=>q(()=>import("./ActivitiesTab-DzTOj4-v.js"),__vite__mapDeps([3,1,2]))),Jr=E.lazy(()=>q(()=>import("./CyclesTab-BgT3GqI-.js"),__vite__mapDeps([4,1,2]))),Zr=E.lazy(()=>q(()=>import("./StatsTab-Bwefhe06.js"),__vite__mapDeps([5,1,2]))),Kr=E.lazy(()=>q(()=>import("./SettingsTab-CM4r5T25.js"),__vite__mapDeps([6,1,2]))),es=()=>o.jsx("div",{className:"flex items-center justify-center py-12",children:o.jsx(k.Loading,{className:"w-8 h-8"})});function ts(){const{isAuthenticated:t,checkAuth:e}=$e(),[r,s]=E.useState(!0),[i,n]=E.useState(!1),{settings:a,loadSettings:l}=D(),{selectedDate:c,currentEntry:d,entries:h,loadEntries:g,changeDate:f,setSelectedDate:x,saveCurrentEntry:m,saveStatus:u}=he(),{activeTab:p,setActiveTab:v,toast:y,openPrintModal:b,isPrintModalOpen:j,togglePrintDate:S,printSelectedDates:w}=P(),_=E.useRef(null),N=mt(p),M=A=>ue(a.lang,A);E.useEffect(()=>{e()},[e]),E.useEffect(()=>{t&&(l(),g())},[t,l,g]),E.useEffect(()=>{const A=document.documentElement;A.setAttribute("data-theme",a.theme),A.setAttribute("data-color",a.colorScheme)},[a.theme,a.colorScheme]),E.useEffect(()=>{if(!d)return;const A=h[d.date];if(JSON.stringify(d)!==JSON.stringify(A))return _.current&&clearTimeout(_.current),_.current=setTimeout(()=>{m()},1500),()=>{_.current&&clearTimeout(_.current)}},[d,h,m]),E.useEffect(()=>{c&&!w.includes(c)&&S(c)},[c,w,S]);const L=()=>{s(!1),setTimeout(()=>{n(!0)},100)};return E.useEffect(()=>{t===!0&&r&&(s(!1),n(!0))},[t,r]),t===null?o.jsxs("div",{className:"h-screen flex items-center justify-center text-[var(--primary)]",children:[o.jsx(k.Loading,{className:"w-8 h-8 mr-2"}),"Vérification..."]}):t===!1||r?o.jsx(Gr,{onLoginSuccess:L}):o.jsxs("div",{className:`min-h-screen pb-32 font-outfit text-[var(--text-main)] relative transition-opacity duration-500 ${i?"opacity-100":"opacity-0"}`,children:[o.jsx("header",{className:"sticky top-0 z-30 bg-[var(--bg-main)]/95 backdrop-blur-xl no-print shadow-lg shadow-black/10",children:o.jsxs("div",{className:"max-w-md mx-auto px-4 py-3 flex items-center justify-between",children:[o.jsx("button",{onClick:()=>f(-1),className:"nav-arrow-btn p-2.5 rounded-xl bg-[var(--bg-card)]/80 hover:bg-[var(--bg-card-hover)] text-[var(--text-secondary)] flex-shrink-0 transition-all hover:text-[var(--primary)]","aria-label":"Jour précédent",children:o.jsx(k.ChevronLeft,{})}),o.jsxs("div",{className:"flex-1 text-center relative group cursor-pointer mx-4",children:[o.jsx("input",{type:"date",value:c,onChange:A=>x(A.target.value),className:"absolute inset-0 opacity-0 w-full cursor-pointer","aria-label":"Sélectionner une date"}),o.jsxs("div",{className:"flex items-center justify-center gap-1.5 mb-0.5",children:[o.jsx("h1",{className:"text-xs font-bold text-[var(--primary)] uppercase tracking-widest",children:M("title")}),u==="saving"&&o.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-amber-400 animate-pulse",title:M("status_saving")}),u==="saved"&&o.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-400 animate-fade-out",title:"Sauvegardé"}),u==="error"&&o.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-rose-400",title:"Erreur"}),u==="offline"&&o.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-400",title:"Hors ligne"})]}),o.jsx("div",{className:"font-bold text-lg text-[var(--text-main)]",children:new Date(c).toLocaleDateString(a.lang==="fr"?"fr-FR":"en-US",{weekday:"long",day:"numeric",month:"short"})})]}),o.jsx("button",{onClick:()=>f(1),className:"nav-arrow-btn p-2.5 rounded-xl bg-[var(--bg-card)]/80 hover:bg-[var(--bg-card-hover)] text-[var(--text-secondary)] flex-shrink-0 transition-all hover:text-[var(--primary)]","aria-label":"Jour suivant",children:o.jsx(k.ChevronRight,{})})]})}),o.jsx("main",{className:`max-w-md mx-auto p-4 no-print ${N}`,children:o.jsxs(E.Suspense,{fallback:o.jsx(es,{}),children:[p==="sleep"&&o.jsx(Xr,{}),p==="activities"&&o.jsx(Qr,{}),p==="cycles"&&o.jsx(Jr,{}),p==="stats"&&o.jsx(Zr,{}),p==="settings"&&o.jsx(Kr,{})]})}),o.jsxs("nav",{className:"fixed bottom-0 left-0 right-0 nav-bar backdrop-blur-xl pb-safe px-4 py-3 z-50 no-print flex justify-between items-center border-t border-[var(--glass-border)]",style:{background:"var(--glass-bg)"},"aria-label":"Navigation principale",children:[o.jsxs("div",{className:"flex gap-1 bg-[var(--bg-card)]/60 backdrop-blur p-1.5 rounded-2xl overflow-x-auto w-full mr-3 shadow-lg shadow-black/10 border border-[var(--border)]",children:[o.jsx(B,{label:M("tab_sleep"),icon:k.Moon,active:p==="sleep",onClick:()=>v("sleep")}),o.jsx(B,{label:M("tab_activities"),icon:k.List,active:p==="activities",onClick:()=>v("activities")}),o.jsx(B,{label:M("tab_cycles"),icon:k.Refresh,active:p==="cycles",onClick:()=>v("cycles")}),o.jsx(B,{label:M("tab_stats"),icon:k.Chart,active:p==="stats",onClick:()=>v("stats")}),o.jsx(B,{label:M("tab_settings"),icon:k.Cog,active:p==="settings",onClick:()=>v("settings")})]}),o.jsx("div",{className:"flex gap-3 flex-shrink-0",children:o.jsx("button",{onClick:b,className:"fab btn-interactive glow-primary ripple-container w-12 h-12 rounded-2xl bg-gradient-to-br from-[var(--primary)] to-[var(--primary-dark)] text-white shadow-lg shadow-[var(--primary)]/40 transition-all flex items-center justify-center","aria-label":"Imprimer",children:o.jsx(k.Printer,{})})})]}),j&&o.jsx(vt,{}),y&&o.jsx(gt,{toast:y}),o.jsx(Yr,{})]})}const Ge=document.getElementById("root");if(!Ge)throw new Error("Root element not found");Pe(Ge).render(o.jsxs(o.Fragment,{children:[o.jsx(Hr,{}),o.jsx(ts,{})]}));export{ds as A,hs as C,dt as D,cs as G,k as I,as as a,D as b,ue as c,ls as d,is as e,ns as f,os as g,P as h,$e as i,o as j,z as k,he as u};
//# sourceMappingURL=index-nMGFLr7G.js.map
