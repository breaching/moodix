import{u as w,b as y,j as e,c as P,I as n,G as k,C as _}from"./index-nMGFLr7G.js";import{r as p}from"./vendor-F9Y4d3HK.js";import"./state-Ck21Aizr.js";function u({count:i,label:l}){return i===0?null:e.jsxs("span",{className:"text-[10px] bg-[var(--bg-elevated)] text-[var(--text-secondary)] px-2 py-0.5 rounded-full",children:[i," ",l]})}function S({cycle:i}){return e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-bold text-[var(--text-main)] truncate max-w-[200px]",children:i.situation||"Sans titre"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(u,{count:i.emotions.length,label:"É"}),e.jsx(u,{count:i.thoughts.length,label:"P"}),e.jsx(u,{count:i.behaviors.length,label:"C"}),e.jsx(u,{count:i.consequences.length,label:"Cs"})]})]})}const q=p.memo(function(){const{currentEntry:l,addCycle:b,updateCycle:g,removeCycle:j,addSubItem:c,updateSubItem:d,removeSubItem:m}=w(),{settings:N}=y(),r=a=>P(N.lang,a),[f,h]=p.useState(null),v=p.useRef(0);p.useEffect(()=>{if(!l)return;const a=l.viciousCycles||[],o=a.length;if(o>v.current&&a.length>0){const x=a.reduce((t,s)=>s.id>t.id?s:t,a[0]);h(x.id)}v.current=o},[l]);const C=a=>{h(o=>o===a?null:a)};return l?e.jsx("div",{className:"space-y-5",children:e.jsxs(k,{className:"bg-[var(--bg-card)] rounded-2xl p-5 shadow-[var(--shadow-md)] card-animated stagger-delay-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xs font-semibold text-[var(--text-secondary)] uppercase tracking-wider flex items-center gap-2",children:[e.jsx(n.Refresh,{className:"w-4 h-4"}),r("cycles_header")]}),e.jsx("button",{onClick:b,className:"btn-interactive text-xs bg-[var(--primary)] text-white px-4 py-2 rounded-lg font-bold shadow-lg shadow-[var(--primary)]/20 hover:shadow-[var(--primary)]/40 transition-all","aria-label":r("new_btn"),children:r("new_btn")})]}),(l.viciousCycles||[]).length===0&&e.jsxs("div",{className:"text-center text-[var(--text-muted)] text-sm py-8 flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-input flex items-center justify-center",children:e.jsx(n.Refresh,{className:"w-8 h-8 text-[var(--text-muted)]/50"})}),e.jsx("span",{children:r("no_cycles")})]}),(l.viciousCycles||[]).map((a,o)=>{const x=f===a.id;return e.jsxs("div",{className:`bg-[var(--bg-main)]/30 rounded-xl overflow-hidden mb-3 last:mb-0 shadow-[var(--shadow-sm)] transition-all duration-300 card-animated stagger-delay-${Math.min(o+2,6)}`,children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 cursor-pointer hover:bg-[var(--bg-main)]/20 transition-colors",onClick:()=>C(a.id),children:[e.jsx("div",{className:"flex-1 min-w-0",children:x?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n.Refresh,{className:"w-4 h-4 text-[var(--primary)]"}),e.jsx("span",{className:"text-xs font-bold text-[var(--primary)] uppercase",children:r("situation_label")})]}):e.jsx(S,{cycle:a})}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("div",{className:`transition-transform duration-200 ${x?"rotate-180":""}`,children:e.jsx(n.ChevronDown,{className:"w-4 h-4 text-[var(--text-muted)]"})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),j(a.id)},className:"w-7 h-7 flex items-center justify-center rounded-lg text-[var(--text-muted)] hover:text-rose-400 hover:bg-rose-400/10 transition-all","aria-label":"Supprimer ce cycle",children:e.jsx(n.X,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:`grid transition-all duration-300 ease-in-out ${x?"grid-rows-[1fr] opacity-100":"grid-rows-[0fr] opacity-0"}`,children:e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"px-3 pb-3",children:e.jsx("input",{id:`situation-${a.id}`,type:"text",value:a.situation,onChange:t=>g(a.id,"situation",t.target.value),onClick:t=>t.stopPropagation(),className:"w-full bg-input rounded-lg px-3 py-2 text-base font-bold text-[var(--text-main)] placeholder-[var(--text-muted)]",placeholder:r("situation_ph")})}),e.jsxs("div",{className:"space-y-px",children:[e.jsxs("div",{className:"bg-[var(--bg-card)]/30 p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("label",{className:"text-[10px] uppercase font-semibold text-[var(--text-secondary)]",children:r("emotions_label")}),e.jsx("button",{onClick:t=>{t.stopPropagation(),c(a.id,"emotions",{name:"",score:5})},className:"text-[var(--primary)] hover:scale-110 transition-transform","aria-label":r("add_emotion"),children:e.jsx(n.Plus,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"space-y-2",children:a.emotions.map(t=>e.jsxs("div",{className:"bg-[var(--bg-main)]/40 p-3 rounded-lg relative",children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),m(a.id,"emotions",t.id)},className:"absolute top-2 right-2 text-[var(--text-muted)] hover:text-rose-400 transition-all","aria-label":"Supprimer cette émotion",children:e.jsx(n.Trash,{className:"w-3.5 h-3.5"})}),e.jsx("input",{type:"text",value:t.name,onClick:s=>s.stopPropagation(),onChange:s=>d(a.id,"emotions",t.id,"name",s.target.value),className:"bg-input rounded-lg px-3 py-1.5 text-sm font-bold text-[var(--text-main)] w-full pr-8 mb-2 placeholder:text-[var(--text-muted)]",placeholder:r("emotions_ph")}),e.jsx(_,{label:r("intensity"),value:t.score,onChange:s=>d(a.id,"emotions",t.id,"score",s)})]},t.id))})]}),e.jsxs("div",{className:"bg-[var(--bg-card)]/30 p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("label",{className:"text-[10px] uppercase font-semibold text-[var(--text-secondary)]",children:r("thoughts_label")}),e.jsx("button",{onClick:t=>{t.stopPropagation(),c(a.id,"thoughts",{text:""})},className:"text-[var(--primary)] hover:scale-110 transition-transform","aria-label":r("add_thought"),children:e.jsx(n.Plus,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"space-y-2",children:a.thoughts.map(t=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("textarea",{value:t.text,onClick:s=>s.stopPropagation(),onChange:s=>d(a.id,"thoughts",t.id,"text",s.target.value),className:"flex-1 bg-input text-xs text-[var(--text-main)] rounded-lg px-3 py-2 resize-none min-h-[40px] placeholder:text-[var(--text-muted)]",placeholder:r("placeholder_txt")}),e.jsx("button",{onClick:s=>{s.stopPropagation(),m(a.id,"thoughts",t.id)},className:"text-[var(--text-muted)] hover:text-rose-400 transition-all mt-2","aria-label":"Supprimer cette pensée",children:e.jsx(n.Trash,{className:"w-3.5 h-3.5"})})]},t.id))})]}),e.jsxs("div",{className:"bg-[var(--bg-card)]/30 p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("label",{className:"text-[10px] uppercase font-semibold text-[var(--text-secondary)]",children:r("behaviors_label")}),e.jsx("button",{onClick:t=>{t.stopPropagation(),c(a.id,"behaviors",{text:""})},className:"text-[var(--primary)] hover:scale-110 transition-transform","aria-label":r("add_behavior"),children:e.jsx(n.Plus,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"space-y-2",children:a.behaviors.map(t=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("textarea",{value:t.text,onClick:s=>s.stopPropagation(),onChange:s=>d(a.id,"behaviors",t.id,"text",s.target.value),className:"flex-1 bg-input text-xs text-[var(--text-main)] rounded-lg px-3 py-2 resize-none min-h-[40px] placeholder:text-[var(--text-muted)]",placeholder:r("placeholder_txt")}),e.jsx("button",{onClick:s=>{s.stopPropagation(),m(a.id,"behaviors",t.id)},className:"text-[var(--text-muted)] hover:text-rose-400 transition-all mt-2","aria-label":"Supprimer ce comportement",children:e.jsx(n.Trash,{className:"w-3.5 h-3.5"})})]},t.id))})]}),e.jsxs("div",{className:"bg-[var(--bg-card)]/30 p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("label",{className:"text-[10px] uppercase font-semibold text-[var(--text-secondary)]",children:r("consequences_label")}),e.jsx("button",{onClick:t=>{t.stopPropagation(),c(a.id,"consequences",{text:""})},className:"text-[var(--primary)] hover:scale-110 transition-transform","aria-label":r("add_consequence"),children:e.jsx(n.Plus,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"space-y-2",children:a.consequences.map(t=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("textarea",{value:t.text,onClick:s=>s.stopPropagation(),onChange:s=>d(a.id,"consequences",t.id,"text",s.target.value),className:"flex-1 bg-input text-xs text-[var(--text-main)] rounded-lg px-3 py-2 resize-none min-h-[40px] placeholder:text-[var(--text-muted)]",placeholder:r("placeholder_txt")}),e.jsx("button",{onClick:s=>{s.stopPropagation(),m(a.id,"consequences",t.id)},className:"text-[var(--text-muted)] hover:text-rose-400 transition-all mt-2","aria-label":"Supprimer cette conséquence",children:e.jsx(n.Trash,{className:"w-3.5 h-3.5"})})]},t.id))})]})]})]})})]},a.id)})]})}):e.jsxs("div",{className:"text-center py-12 text-[var(--text-muted)]",children:[e.jsx(n.Loading,{className:"w-8 h-8 mx-auto mb-2"}),r("loading")]})});export{q as default};
//# sourceMappingURL=CyclesTab-BgT3GqI-.js.map
