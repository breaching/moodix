import{b as W,h as q,i as F,k as x,j as e,c as V,G as g,I as o,d as L,a as z,g as G}from"./index-CjjUWgXV.js";import{r as d}from"./vendor-F9Y4d3HK.js";import"./state-Ck21Aizr.js";const Y=d.memo(function(){const{settings:r,updateSettings:v,updateConsumable:p}=W(),{showToast:l}=q(),{logout:A,isAdmin:b}=F(),y=d.useRef(null),[N,$]=d.useState([]),[P,k]=d.useState(!1),[C,f]=d.useState(!1),[n,h]=d.useState({username:"",email:"",password:"",is_admin:!1}),[_,S]=d.useState(null),[j,U]=d.useState(""),t=a=>V(r.lang,a),c=d.useCallback(async()=>{k(!0);try{const a=await x.admin.listUsers();a!=null&&a.users&&$(a.users)}catch(a){console.error("loadUsers error:",a)}k(!1)},[]);d.useEffect(()=>{b&&c()},[b,c]);const R=async()=>{if(!n.username||!n.password){l(r.lang==="fr"?"Nom et mot de passe requis":"Username and password required","error");return}if(n.password.length<8){l(r.lang==="fr"?"Le mot de passe doit contenir au moins 8 caractères":"Password must be at least 8 characters","error");return}if(n.username.length<3){l(r.lang==="fr"?"Le nom doit contenir au moins 3 caractères":"Username must be at least 3 characters","error");return}const a=await x.admin.createUser(n.username,n.password,n.email,n.is_admin);if(a.ok)l(r.lang==="fr"?"Utilisateur créé":"User created","success"),h({username:"",email:"",password:"",is_admin:!1}),f(!1),c();else{const s=a.data,m=s!=null&&s.includes("already exists")?r.lang==="fr"?"Ce nom ou email existe déjà":"Username or email already exists":r.lang==="fr"?"Erreur création":"Creation error";l(m,"error")}},M=async a=>{(await x.admin.deleteUser(a)).ok?(l(r.lang==="fr"?"Utilisateur supprimé":"User deleted","success"),c()):l(r.lang==="fr"?"Erreur suppression":"Delete error","error")},E=async a=>{(await x.admin.updateUser(a.id,{is_admin:!a.is_admin})).ok&&(l(r.lang==="fr"?"Rôle mis à jour":"Role updated","success"),c())},I=async a=>{(await x.admin.updateUser(a.id,{is_active:!a.is_active})).ok&&(l(r.lang==="fr"?"Statut mis à jour":"Status updated","success"),c())},D=async a=>{if(!j){l(r.lang==="fr"?"Mot de passe requis":"Password required","error");return}(await x.admin.resetPassword(a,j)).ok?(l(r.lang==="fr"?"Mot de passe réinitialisé":"Password reset","success"),S(null),U("")):l(r.lang==="fr"?"Erreur réinitialisation":"Reset error","error")},T=()=>{window.open("/api/export/json","_blank")},B=a=>{var u;const s=(u=a.target.files)==null?void 0:u[0];if(!s)return;const m=new FileReader;m.onload=w=>{var i;try{JSON.parse((i=w.target)==null?void 0:i.result),l("Données importées !","success")}catch{l("Erreur fichier invalide","error")}},m.readAsText(s)},H=async()=>{await A()},O=[{name:"violet",colorClass:"bg-violet-500"},{name:"blue",colorClass:"bg-blue-500"},{name:"green",colorClass:"bg-emerald-500"},{name:"rose",colorClass:"bg-rose-500"},{name:"orange",colorClass:"bg-orange-500"}];return e.jsxs("div",{className:"space-y-5",children:[e.jsx("h2",{className:"text-xl font-bold text-center mb-6 text-[var(--text-main)]",children:t("settings_title")}),e.jsxs(g,{className:"bg-[var(--bg-card)] rounded-2xl p-5 shadow-[var(--shadow-md)] card-animated stagger-delay-1",children:[e.jsx("h3",{className:"text-xs font-semibold text-[var(--text-secondary)] mb-4 uppercase tracking-wider",children:t("lang_title")}),e.jsxs("div",{className:"flex gap-3",role:"radiogroup","aria-label":t("lang_title"),children:[e.jsx("button",{onClick:()=>v({lang:"fr"}),className:`btn-interactive flex-1 py-3 rounded-xl font-bold transition-all ${r.lang==="fr"?"bg-[var(--primary)] text-white shadow-lg shadow-[var(--primary)]/20":"bg-input text-[var(--text-secondary)] hover:bg-[var(--bg-elevated)]"}`,role:"radio","aria-checked":r.lang==="fr",children:"Français"}),e.jsx("button",{onClick:()=>v({lang:"en"}),className:`btn-interactive flex-1 py-3 rounded-xl font-bold transition-all ${r.lang==="en"?"bg-[var(--primary)] text-white shadow-lg shadow-[var(--primary)]/20":"bg-input text-[var(--text-secondary)] hover:bg-[var(--bg-elevated)]"}`,role:"radio","aria-checked":r.lang==="en",children:"English"})]})]}),e.jsxs(g,{className:"bg-[var(--bg-card)] rounded-2xl p-5 shadow-[var(--shadow-md)] card-animated stagger-delay-2",children:[e.jsx("h3",{className:"text-xs font-semibold text-[var(--text-secondary)] mb-4 uppercase tracking-wider",children:t("appearance")}),e.jsxs("div",{className:"mb-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-[var(--text-main)] mb-3",children:t("theme_mode")}),e.jsxs("div",{className:"flex gap-3",role:"radiogroup","aria-label":t("theme_mode"),children:[e.jsxs("button",{onClick:()=>v({theme:"dark"}),className:`btn-interactive flex-1 py-3 px-4 rounded-xl font-bold transition-all flex items-center justify-center gap-2 ${r.theme==="dark"?"bg-[var(--primary)] text-white shadow-lg shadow-[var(--primary)]/20":"bg-input text-[var(--text-secondary)] hover:bg-[var(--bg-elevated)]"}`,role:"radio","aria-checked":r.theme==="dark",children:[e.jsx(o.Moon,{className:"w-4 h-4"}),t("theme_dark")]}),e.jsxs("button",{onClick:()=>v({theme:"light"}),className:`btn-interactive flex-1 py-3 px-4 rounded-xl font-bold transition-all flex items-center justify-center gap-2 ${r.theme==="light"?"bg-[var(--primary)] text-white shadow-lg shadow-[var(--primary)]/20":"bg-input text-[var(--text-secondary)] hover:bg-[var(--bg-elevated)]"}`,role:"radio","aria-checked":r.theme==="light",children:[e.jsx(o.Sun,{className:"w-4 h-4"}),t("theme_light")]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-[var(--text-main)] mb-3",children:t("color_scheme")}),e.jsx("div",{className:"grid grid-cols-5 gap-2",role:"radiogroup","aria-label":t("color_scheme"),children:O.map((a,s)=>e.jsxs("button",{onClick:()=>v({colorScheme:a.name}),className:`relative py-3 px-2 rounded-xl font-bold transition-all hover:scale-105 card-animated stagger-delay-${s+1} ${r.colorScheme===a.name?"bg-[var(--bg-elevated)] scale-105":"bg-[var(--bg-main)]/30"}`,role:"radio","aria-checked":r.colorScheme===a.name,"aria-label":t(`color_${a.name}`),children:[e.jsx("div",{className:`w-8 h-8 rounded-full ${a.colorClass} mx-auto mb-1 shadow-lg transition-transform ${r.colorScheme===a.name?"scale-110 ring-2 ring-white/30":""}`}),e.jsx("div",{className:"text-xs text-[var(--text-secondary)]",children:t(`color_${a.name}`)}),r.colorScheme===a.name&&e.jsx("div",{className:"absolute top-1 right-1 text-[var(--primary)] animate-pop-in",children:e.jsx(o.CheckSmall,{})})]},a.name))})]})]}),e.jsxs(g,{className:"bg-[var(--bg-card)] rounded-2xl p-5 shadow-[var(--shadow-md)] card-animated stagger-delay-4",children:[e.jsx("h3",{className:"text-xs font-semibold text-[var(--text-secondary)] mb-4 uppercase tracking-wider",children:t("config_consumables")}),e.jsx("div",{className:"space-y-3",children:r.consumables.map((a,s)=>{const m=L[a.icon]||o.Leaf,u=z(a.key),w=G(a.key);return e.jsxs("div",{className:"bg-input p-3 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:w,color:u},children:e.jsx(m,{className:"w-4 h-4"})}),e.jsx("input",{type:"text",value:a.label,onChange:i=>p(s,"label",i.target.value),className:"bg-transparent font-bold text-[var(--text-main)] border-b border-[var(--border-light)] w-full placeholder:text-[var(--text-muted)]",placeholder:t("label_txt"),"aria-label":`Nom pour ${a.key}`})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("select",{value:a.icon,onChange:i=>p(s,"icon",i.target.value),className:"bg-[var(--bg-elevated)] text-xs text-[var(--text-main)] rounded-lg px-2 py-1.5","aria-label":`Icône pour ${a.label}`,children:Object.keys(L).map(i=>e.jsx("option",{value:i,children:i},i))}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-[var(--text-secondary)] cursor-pointer ml-auto",children:[e.jsx("input",{type:"checkbox",checked:a.active,onChange:i=>p(s,"active",i.target.checked),className:"accent-[var(--primary)] w-4 h-4"}),t("visible_txt")]})]})]},a.key)})})]}),e.jsxs(g,{className:"bg-[var(--bg-card)] rounded-2xl p-5 shadow-[var(--shadow-md)] card-animated stagger-delay-5",children:[e.jsx("h3",{className:"text-xs font-semibold text-[var(--text-secondary)] mb-4 uppercase tracking-wider",children:t("data_management")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-[var(--bg-main)]/30 p-4 rounded-xl",children:[e.jsx("h4",{className:"text-xs font-semibold text-[var(--text-secondary)] mb-3",children:"EXPORT"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:()=>window.open("/api/export/json","_blank"),className:"btn-interactive flex flex-col items-center gap-1 py-3 bg-[var(--bg-elevated)] hover:bg-[var(--bg-card-hover)] rounded-lg text-xs font-bold text-[var(--text-main)] transition-all",children:[e.jsx(o.Download,{className:"w-4 h-4"}),e.jsx("span",{children:"JSON"})]}),e.jsxs("button",{onClick:()=>window.open("/api/export/csv","_blank"),className:"btn-interactive flex flex-col items-center gap-1 py-3 bg-[var(--bg-elevated)] hover:bg-[var(--bg-card-hover)] rounded-lg text-xs font-bold text-[var(--text-main)] transition-all",children:[e.jsx(o.Download,{className:"w-4 h-4"}),e.jsx("span",{children:"CSV"})]}),e.jsxs("button",{onClick:()=>window.open("/api/export/pdf","_blank"),className:"btn-interactive flex flex-col items-center gap-1 py-3 bg-[var(--bg-elevated)] hover:bg-[var(--bg-card-hover)] rounded-lg text-xs font-bold text-[var(--text-main)] transition-all",children:[e.jsx(o.Download,{className:"w-4 h-4"}),e.jsx("span",{children:"PDF"})]})]})]}),e.jsxs("button",{onClick:T,className:"btn-interactive w-full flex items-center justify-center gap-2 py-3 bg-[var(--bg-elevated)] hover:bg-[var(--bg-card-hover)] rounded-xl font-bold text-[var(--text-main)] transition-all",children:[e.jsx(o.Download,{className:"w-4 h-4"}),t("export_data")," (Local)"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",ref:y,onChange:B,accept:".json",className:"hidden","aria-label":t("import_data")}),e.jsxs("button",{onClick:()=>{var a;return(a=y.current)==null?void 0:a.click()},className:"btn-interactive w-full flex items-center justify-center gap-2 py-3 bg-[var(--bg-elevated)] hover:bg-[var(--bg-card-hover)] rounded-xl font-bold text-[var(--text-main)] transition-all",children:[e.jsx(o.Upload,{className:"w-4 h-4"}),t("import_data")]})]})]})]}),b&&e.jsxs(g,{className:"bg-[var(--bg-card)] rounded-2xl p-5 shadow-[var(--shadow-md)] card-animated stagger-delay-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-xs font-semibold text-[var(--text-secondary)] uppercase tracking-wider flex items-center gap-2",children:[e.jsx(o.Shield,{className:"w-4 h-4"}),t("user_management")]}),e.jsxs("button",{onClick:()=>f(!C),className:"btn-interactive text-xs px-3 py-1.5 rounded-lg bg-[var(--primary)]/20 text-[var(--primary)] hover:bg-[var(--primary)]/30 font-semibold transition-all flex items-center gap-1",children:[e.jsx(o.Plus,{className:"w-3 h-3"}),r.lang==="fr"?"Ajouter":"Add"]})]}),C&&e.jsxs("div",{className:"bg-[var(--bg-main)]/30 p-4 rounded-xl mb-4 space-y-3",children:[e.jsx("input",{type:"text",placeholder:r.lang==="fr"?"Nom d'utilisateur":"Username",value:n.username,onChange:a=>h({...n,username:a.target.value}),className:"w-full px-3 py-2 bg-[var(--bg-elevated)] rounded-lg text-sm text-[var(--text-main)] border border-[var(--border)] focus:ring-2 focus:ring-[var(--primary)]/50 outline-none"}),e.jsx("input",{type:"email",placeholder:"Email",value:n.email,onChange:a=>h({...n,email:a.target.value}),className:"w-full px-3 py-2 bg-[var(--bg-elevated)] rounded-lg text-sm text-[var(--text-main)] border border-[var(--border)] focus:ring-2 focus:ring-[var(--primary)]/50 outline-none"}),e.jsx("input",{type:"password",placeholder:r.lang==="fr"?"Mot de passe":"Password",value:n.password,onChange:a=>h({...n,password:a.target.value}),className:"w-full px-3 py-2 bg-[var(--bg-elevated)] rounded-lg text-sm text-[var(--text-main)] border border-[var(--border)] focus:ring-2 focus:ring-[var(--primary)]/50 outline-none"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-[var(--text-secondary)] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.is_admin,onChange:a=>h({...n,is_admin:a.target.checked}),className:"accent-[var(--primary)] w-4 h-4"}),"Admin"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>void R(),className:"flex-1 py-2 bg-[var(--primary)] text-white rounded-lg text-sm font-bold hover:bg-[var(--primary-dark)] transition-all",children:r.lang==="fr"?"Créer":"Create"}),e.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 bg-[var(--bg-elevated)] text-[var(--text-secondary)] rounded-lg text-sm font-bold hover:bg-[var(--bg-card-hover)] transition-all",children:r.lang==="fr"?"Annuler":"Cancel"})]})]}),P?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(o.Loading,{className:"w-6 h-6"})}):e.jsxs("div",{className:"space-y-2",children:[N.map(a=>e.jsxs("div",{className:`bg-[var(--bg-main)]/30 p-3 rounded-xl transition-all ${a.is_active?"":"opacity-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold text-white ${a.is_admin?"bg-[var(--primary)]":"bg-[var(--text-muted)]"}`,children:a.username.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-bold text-[var(--text-main)] flex items-center gap-2",children:[a.username,a.is_admin&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-[var(--primary)]/20 text-[var(--primary)]",children:"Admin"})]}),a.email&&e.jsx("div",{className:"text-xs text-[var(--text-muted)]",children:a.email})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>void I(a),className:`p-1.5 rounded-lg transition-all ${a.is_active?"text-emerald-400 hover:bg-emerald-400/10":"text-[var(--text-muted)] hover:bg-[var(--bg-elevated)]"}`,title:a.is_active?"Désactiver":"Activer",children:a.is_active?e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})})}),e.jsx("button",{onClick:()=>void E(a),className:`p-1.5 rounded-lg transition-all ${a.is_admin?"text-[var(--primary)] hover:bg-[var(--primary)]/10":"text-[var(--text-muted)] hover:bg-[var(--bg-elevated)]"}`,title:a.is_admin?"Retirer admin":"Rendre admin",children:e.jsx(o.Shield,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>S(_===a.id?null:a.id),className:"p-1.5 rounded-lg text-[var(--text-muted)] hover:bg-[var(--bg-elevated)] hover:text-amber-400 transition-all",title:"Réinitialiser mot de passe",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})})}),e.jsx("button",{onClick:()=>void M(a.id),className:"p-1.5 rounded-lg text-[var(--text-muted)] hover:bg-red-500/10 hover:text-red-400 transition-all",title:"Supprimer",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),_===a.id&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-[var(--border)] flex gap-2",children:[e.jsx("input",{type:"password",placeholder:r.lang==="fr"?"Nouveau mot de passe":"New password",value:j,onChange:s=>U(s.target.value),className:"flex-1 px-3 py-2 bg-[var(--bg-elevated)] rounded-lg text-sm text-[var(--text-main)] border border-[var(--border)] focus:ring-2 focus:ring-[var(--primary)]/50 outline-none"}),e.jsx("button",{onClick:()=>void D(a.id),className:"px-4 py-2 bg-amber-500/20 text-amber-400 rounded-lg text-sm font-bold hover:bg-amber-500/30 transition-all",children:"OK"})]})]},a.id)),N.length===0&&e.jsx("div",{className:"text-center py-4 text-[var(--text-muted)] text-sm",children:r.lang==="fr"?"Aucun utilisateur":"No users"})]})]}),e.jsx(g,{className:"bg-[var(--bg-card)] rounded-2xl p-5 shadow-[var(--shadow-md)] card-animated stagger-delay-6",children:e.jsxs("button",{onClick:()=>void H(),className:"btn-interactive w-full flex items-center justify-center gap-2 py-3 bg-rose-500/10 hover:bg-rose-500/20 rounded-xl font-bold text-rose-400 transition-all",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),r.lang==="fr"?"Déconnexion":"Logout"]})})]})});export{Y as default};
//# sourceMappingURL=SettingsTab-BesURcyG.js.map
