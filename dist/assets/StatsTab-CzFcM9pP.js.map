{"version":3,"file":"StatsTab-CzFcM9pP.js","sources":["../../src/components/stats/StatsTab.tsx"],"sourcesContent":["import { memo, useMemo } from 'react';\nimport { useJournalStore, useSettingsStore } from '@/stores';\nimport { getTranslation } from '@/utils/translations';\nimport { GlowCard, AnimatedNumber, Icons } from '@/components/ui';\n\n/**\n * Statistics and analysis tab component\n */\nconst StatsTab = memo(function StatsTab() {\n  const { entries, currentEntry, updateEntry } = useJournalStore();\n  const { settings } = useSettingsStore();\n  const t = (key: Parameters<typeof getTranslation>[1]) => getTranslation(settings.lang, key);\n\n  // Calculate weekly stats\n  const weeklyStats = useMemo(() => {\n    const entriesArray = Object.values(entries);\n    const last7Days = entriesArray.slice(-7);\n\n    // Average mood\n    const moodsWithValue = last7Days.filter(\n      (e) => e.generalMood && parseInt(String(e.generalMood), 10) > 0\n    );\n    const avgMood =\n      moodsWithValue.reduce((sum, e) => sum + parseFloat(String(e.generalMood)), 0) /\n      (moodsWithValue.length || 1);\n\n    // Average sleep\n    let totalSleep = 0;\n    let sleepCount = 0;\n    last7Days.forEach((e) => {\n      if (e.sleepHours && e.sleepHours.length > 0) {\n        const hours = e.sleepHours.filter(Boolean).length;\n        if (hours > 0) {\n          totalSleep += hours;\n          sleepCount++;\n        }\n      }\n    });\n    const avgSleep = sleepCount > 0 ? totalSleep / sleepCount : 0;\n\n    // Total activities\n    const totalActivities = last7Days.reduce((sum, e) => {\n      if (!e.activityLog) return sum;\n      return sum + e.activityLog.reduce((s, slot) => s + (slot.activities?.length || 0), 0);\n    }, 0);\n\n    // Completed days\n    const completedDays = last7Days.filter(\n      (e) =>\n        e.generalMood ||\n        (e.sleepHours && e.sleepHours.filter(Boolean).length > 0) ||\n        (e.activityLog && e.activityLog.some((s) => s.activities?.length > 0))\n    ).length;\n\n    return { avgMood, avgSleep, totalActivities, completedDays };\n  }, [entries]);\n\n  // Calculate top activities\n  const topActivities = useMemo(() => {\n    const allActivities: { name: string; plaisir: number }[] = [];\n    Object.values(entries).forEach((entry) => {\n      if (!entry.activityLog) return;\n      entry.activityLog.forEach((slot) => {\n        slot.activities?.forEach((act) => {\n          if (act.name) {\n            allActivities.push({ name: act.name, plaisir: act.plaisir || 0 });\n          }\n        });\n      });\n    });\n\n    // Group by name and average pleasure score\n    const grouped = allActivities.reduce(\n      (acc, act) => {\n        if (!acc[act.name]) {\n          acc[act.name] = { total: 0, count: 0 };\n        }\n        acc[act.name].total += act.plaisir;\n        acc[act.name].count++;\n        return acc;\n      },\n      {} as Record<string, { total: number; count: number }>\n    );\n\n    return Object.entries(grouped)\n      .map(([name, data]) => ({\n        name,\n        avgPlaisir: data.total / data.count,\n        count: data.count,\n      }))\n      .sort((a, b) => b.avgPlaisir - a.avgPlaisir)\n      .slice(0, 5);\n  }, [entries]);\n\n  if (!currentEntry) {\n    return (\n      <div className=\"text-center py-12 text-[var(--text-muted)]\">\n        <Icons.Loading className=\"w-8 h-8 mx-auto mb-2\" />\n        {t('loading')}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Weekly summary stats */}\n      <div className=\"grid grid-cols-2 gap-4\" role=\"region\" aria-label=\"Statistiques hebdomadaires\">\n        <div className=\"stat-card bg-gradient-to-br from-[var(--primary)]/20 to-[var(--primary-dark)]/10 rounded-xl p-4 shadow-lg shadow-[var(--primary)]/10 card-animated stagger-delay-1 hover:scale-[1.02] transition-transform border border-[var(--primary)]/20 backdrop-blur-sm\">\n          <div className=\"text-xs text-[var(--text-secondary)] mb-1\">{t('last_week')}</div>\n          <div className=\"text-2xl font-bold text-[var(--primary)]\">\n            <AnimatedNumber value={weeklyStats.avgMood.toFixed(1)} />\n          </div>\n          <div className=\"text-xs text-[var(--text-muted)]\">{t('mood_trend')}</div>\n        </div>\n\n        <div className=\"stat-card bg-gradient-to-br from-blue-500/20 to-blue-600/10 rounded-xl p-4 shadow-lg shadow-blue-500/10 card-animated stagger-delay-2 hover:scale-[1.02] transition-transform border border-blue-500/20 backdrop-blur-sm\">\n          <div className=\"text-xs text-[var(--text-secondary)] mb-1\">{t('last_week')}</div>\n          <div className=\"text-2xl font-bold text-blue-400\">\n            <AnimatedNumber value={weeklyStats.avgSleep.toFixed(1)} />h\n          </div>\n          <div className=\"text-xs text-[var(--text-muted)]\">{t('sleep_average')}</div>\n        </div>\n\n        <div className=\"stat-card bg-gradient-to-br from-emerald-500/20 to-emerald-600/10 rounded-xl p-4 shadow-lg shadow-emerald-500/10 card-animated stagger-delay-3 hover:scale-[1.02] transition-transform border border-emerald-500/20 backdrop-blur-sm\">\n          <div className=\"text-xs text-[var(--text-secondary)] mb-1\">{t('last_week')}</div>\n          <div className=\"text-2xl font-bold text-emerald-400\">\n            <AnimatedNumber value={weeklyStats.totalActivities} />\n          </div>\n          <div className=\"text-xs text-[var(--text-muted)]\">{t('tab_activities')}</div>\n        </div>\n\n        <div className=\"stat-card bg-gradient-to-br from-orange-500/20 to-orange-600/10 rounded-xl p-4 shadow-lg shadow-orange-500/10 card-animated stagger-delay-4 hover:scale-[1.02] transition-transform border border-orange-500/20 backdrop-blur-sm\">\n          <div className=\"text-xs text-[var(--text-secondary)] mb-1\">{t('last_week')}</div>\n          <div className=\"text-2xl font-bold text-orange-400\">\n            <AnimatedNumber value={weeklyStats.completedDays} />/7\n          </div>\n          <div className=\"text-xs text-[var(--text-muted)]\">\n            {t('days_streak').replace('{count}', '')}\n          </div>\n        </div>\n      </div>\n\n      {/* Chart placeholder */}\n      <GlowCard className=\"bg-[var(--bg-card)] rounded-2xl p-5 shadow-[var(--shadow-md)] card-animated stagger-delay-3\">\n        <h3 className=\"text-xs font-bold text-[var(--text-secondary)] mb-4 uppercase tracking-wider flex items-center gap-2\">\n          <span className=\"stats-icon\">\n            <Icons.Chart />\n          </span>\n          {t('stats_sleep_mood')}\n        </h3>\n        <div className=\"h-40 flex items-center justify-center text-[var(--text-muted)] text-sm\">\n          {Object.keys(entries).length < 3 ? (\n            t('no_data')\n          ) : (\n            <div className=\"w-full\">\n              {/* Simple bar visualization */}\n              <div className=\"flex items-end justify-around h-32 gap-1\">\n                {Object.entries(entries)\n                  .slice(-7)\n                  .map(([date, entry]) => {\n                    const mood = parseInt(String(entry.generalMood) || '0', 10);\n                    const sleep = entry.sleepHours?.filter(Boolean).length || 0;\n                    return (\n                      <div key={date} className=\"flex-1 flex flex-col items-center gap-1\">\n                        <div\n                          className=\"w-full bg-[var(--primary)]/60 rounded-t transition-all\"\n                          style={{ height: `${mood * 10}%` }}\n                          title={`Humeur: ${mood}/10`}\n                        />\n                        <div\n                          className=\"w-full bg-blue-400/60 rounded-t transition-all\"\n                          style={{ height: `${(sleep / 12) * 100}%` }}\n                          title={`Sommeil: ${sleep}h`}\n                        />\n                        <span className=\"text-[8px] text-[var(--text-muted)]\">\n                          {new Date(date).getDate()}\n                        </span>\n                      </div>\n                    );\n                  })}\n              </div>\n            </div>\n          )}\n        </div>\n      </GlowCard>\n\n      {/* Thoughts journal */}\n      <GlowCard className=\"bg-[var(--bg-card)] rounded-2xl p-5 shadow-[var(--shadow-md)] card-animated stagger-delay-4\">\n        <h3 className=\"text-xs font-bold text-[var(--text-secondary)] mb-4 uppercase tracking-wider flex items-center gap-2\">\n          <span className=\"stats-icon\">\n            <Icons.Brain />\n          </span>\n          {t('stats_thoughts')}\n        </h3>\n        <textarea\n          placeholder={t('stats_thoughts_ph')}\n          value={currentEntry.thoughts}\n          onChange={(e) => updateEntry('thoughts', e.target.value)}\n          className=\"w-full h-32 bg-input rounded-xl p-3 text-sm text-[var(--text-main)] focus:ring-2 focus:ring-[var(--primary)]/50 outline-none resize-none transition-colors\"\n          aria-label={t('stats_thoughts')}\n        />\n      </GlowCard>\n\n      {/* Top activities */}\n      <GlowCard className=\"bg-[var(--bg-card)] rounded-2xl p-5 shadow-[var(--shadow-md)] card-animated stagger-delay-5\">\n        <h3 className=\"text-xs font-bold text-[var(--text-secondary)] mb-4 uppercase tracking-wider flex items-center gap-2\">\n          <span className=\"stats-icon\">\n            <Icons.List />\n          </span>\n          {t('stats_top_act')}\n        </h3>\n        {topActivities.length === 0 ? (\n          <div className=\"text-center text-[var(--text-muted)] text-sm py-4\">{t('no_data')}</div>\n        ) : (\n          <div className=\"space-y-2\">\n            {topActivities.map((act, idx) => (\n              <div\n                key={act.name}\n                className=\"flex items-center gap-3 p-2 rounded-lg bg-input\"\n              >\n                <span className=\"text-lg font-bold text-[var(--primary)] w-6\">{idx + 1}</span>\n                <div className=\"flex-1\">\n                  <div className=\"text-sm font-semibold text-[var(--text-main)]\">{act.name}</div>\n                  <div className=\"text-xs text-[var(--text-muted)]\">{act.count} fois</div>\n                </div>\n                <div className=\"text-sm font-bold text-emerald-400\">\n                  {act.avgPlaisir.toFixed(1)}\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </GlowCard>\n    </div>\n  );\n});\n\nexport default StatsTab;\n"],"names":["StatsTab","memo","entries","currentEntry","updateEntry","useJournalStore","settings","useSettingsStore","t","key","getTranslation","weeklyStats","useMemo","last7Days","moodsWithValue","e","avgMood","sum","totalSleep","sleepCount","hours","avgSleep","totalActivities","s","slot","_a","completedDays","topActivities","allActivities","entry","act","grouped","acc","name","data","a","b","jsxs","jsx","AnimatedNumber","GlowCard","Icons","date","mood","sleep","idx"],"mappings":"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"}